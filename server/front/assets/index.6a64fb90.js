import{x as s}from"./x6.56983500.js";import{r as i,a as f}from"./index.64257940.js";import{A as N}from"./index.bf34cfca.js";import{K as y}from"./parser.542c3b4e.js";import"./isArrayLikeObject.9676d780.js";import"./_baseIsEqual.ae1f3f6e.js";import"./get.ab779695.js";import"./isSymbol.d728fe31.js";import"./identity.af5bbf98.js";import"./_copyArray.ed92a2fd.js";import"./button.ca276c4e.js";import"./omit.173224d8.js";import"./type.4482a080.js";import"./index.39cec35d.js";import"./context.4fcda71f.js";import"./Portal.bf2e5144.js";import"./index.9d56ca15.js";import"./row.04cc9265.js";import"./styleChecker.9486324a.js";import"./responsiveObserve.a761adf9.js";import"./index.61964446.js";import"./index.27788710.js";import"./iconUtil.71342ca5.js";import"./pickAttrs.91b30b21.js";import"./Overflow.ff04d686.js";import"./statusUtils.e7207d24.js";import"./SearchOutlined.d2d234c2.js";import"./index.4ef503cf.js";import"./workbenchContext.4d536977.js";const Y=()=>{const{schemaAST:n,schema:r}=N(),b=i.exports.useRef(null),x=i.exports.useMemo(()=>{var e,o,t;return Object.keys({...(e=r==null?void 0:r.getQueryType())==null?void 0:e.getFields(),...(o=r==null?void 0:r.getMutationType())==null?void 0:o.getFields(),...(t=r==null?void 0:r.getSubscriptionType())==null?void 0:t.getFields()})},[r]),l=i.exports.useMemo(()=>{var e;return((e=n==null?void 0:n.definitions)==null?void 0:e[0].kind)===y.OPERATION_DEFINITION&&n.definitions[0].selectionSet.selections||[]},[n]),a=i.exports.useMemo(()=>{const e=[],o=[];function t(d,h,g){var k;for(const u of d)if(u.kind===y.FIELD){const E=[],m=u.name.value;if(x.includes(m)){const p=m.split("_").shift();h.push({name:m,children:E,from:g,to:p}),o.includes(p)||o.push(p),(k=u.selectionSet)!=null&&k.selections.length&&t(u.selectionSet.selections,E,p)}}}return t(l,e,""),{sequenceList:e,dataSourceList:o}},[x,l]);i.exports.useEffect(()=>(s.Graph.registerNode("block",{inherit:"rect",width:80,height:32,attrs:{body:{fill:"none",strokeWidth:.5,stroke:"#333",rx:4,ry:4},text:{fontSize:14,fill:"#333333"}}}),s.Graph.registerEdge("block-connector",{attrs:{line:{stroke:"#888",targetMarker:""}}}),s.Graph.registerEdge("flow",{attrs:{line:{stroke:"#666",targetMarker:{name:"block",width:5,height:8}}}}),s.Graph.registerEdge("dash-flow",{attrs:{line:{stroke:"#666",strokeWidth:.5,strokeDasharray:"3 3",targetMarker:{name:"block",width:5,height:8}}}}),()=>{s.Graph.unregisterNode("block"),s.Graph.unregisterEdge("block-connector"),s.Graph.unregisterEdge("flow"),s.Graph.unregisterEdge("dash-flow")}),[]);const c=i.exports.useMemo(()=>100*(2+a.dataSourceList.length)-35,[a.dataSourceList.length]);return i.exports.useEffect(()=>{if(l.length){const e=new s.Graph({container:b.current,mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},interacting:{nodeMovable:!1,edgeMovable:!1,edgeLabelMovable:!1,arrowheadMovable:!1,vertexMovable:!1,useEdgeTools:!1},autoResize:!0}),o=[e.createNode({shape:"block",label:"\u5BA2\u6237\u7AEF",x:12,y:12}),e.createNode({shape:"block",label:"\u5BA2\u6237\u7AEF",x:12,y:c-35}),e.createNode({shape:"block",label:"\u670D\u52A1\u7AEF",x:124,y:12}),e.createNode({shape:"block",label:"\u670D\u52A1\u7AEF",x:124,y:c-35})];for(const[t,d]of a.dataSourceList.entries()){const h=e.createNode({shape:"block",label:d,x:20+112*(t+2),y:12});o.push(h);const g=e.createNode({shape:"block",label:d,x:20+112*(t+2),y:c-35});o.push(g)}e.addNodes([...o]);for(let t=0;t<o.length;t=t+2)e.addEdge({shape:"block-connector",source:o[t],target:o[t+1]});e.addEdge({shape:"flow",source:{x:52,y:56},target:{x:164,y:56}}),e.addEdge({shape:"dash-flow",source:{x:164,y:108},target:{x:52,y:108}})}},[c,l,a.dataSourceList,a.sequenceList]),f("div",{className:"bg-white rounded shadow p-2",children:f("div",{ref:b,className:"min-w-120 min-h-80",style:{width:`${40+(2+a.dataSourceList.length)*112}px`,height:`${c+40}px`},children:!l.length&&f("div",{className:"p-4",children:"\u6682\u65E0\u5185\u5BB9"})})})};export{Y as default};

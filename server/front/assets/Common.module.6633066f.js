import{r as u,b as U,a as e,j as d,F as $,a9 as w,av as q}from"./index.64257940.js";import{B as g}from"./button.ca276c4e.js";import{C as V}from"./index.39cec35d.js";import{F as n}from"./index.9d56ca15.js";import"./row.04cc9265.js";import"./index.61964446.js";import{I as o}from"./index.93b57069.js";import{R as F}from"./Tree.0082570b.js";import{l as T}from"./Editor.88c5e82e.js";import{R as G}from"./main.5d92847d.js";import{i as m}from"./use-immer.module.72e4ecef.js";import{E as P}from"./50x.81c416c8.js";import{e as W,c as K}from"./User.bd84eabb.js";import{s as _}from"./subs.module.53f6f584.js";T.config({paths:{vs:"/modules/monaco-editor/min/vs"}});const M=[{label:"\u57FA\u4E8ECookie",value:"cookieBased"},{label:"\u57FA\u4E8EToken",value:"tokenBased"}];function pe({content:t,onChange:A,onTest:j}){const{handleBottomToggleDesigner:k}=u.exports.useContext(W);u.exports.useContext(K);const[l]=n.useForm(),B=n.useWatch("issuer",l),[D,y]=m(""),r=t.config,[C,x]=m(r.jwks==1),[Y,b]=m(!1),N=U();m("");const[S,E]=u.exports.useState({}),[v,I]=u.exports.useState("");u.exports.useState(""),u.exports.useState("");const p=u.exports.useRef("");if(u.exports.useEffect(()=>{try{E(JSON.parse(String(r.jwksJSON||"{}")))}catch(s){E({}),console.error(s)}I(JSON.stringify(S))},[t]),!t)return e(P,{});const J=async s=>{s.jwks==1&&(s.jwksJSON=v);const a={...r,...s},i={...t,switchState:s.switchState,name:s.id};if(t.name==""){const c={...i,config:a};Reflect.deleteProperty(c,"id");const f=await w.post("/auth",c);t.id=f}else await w.put("/auth",{...i,config:a});w.get("/auth").then(c=>{A(c.filter(f=>f.id===t.id)[0])}).then(()=>{k("data",t.id)})},R=s=>{y(s),x(s=="1")},O=async s=>{const a=`${s.replace(/\/+$/,"")}/.well-known/openid-configuration`;try{new URL(a)}catch{return}if(p.current===a)return;p.current=a;const i=await q.get(a);p.current===a&&(l.setFieldValue("jwksURL",i.data.jwks_uri),l.setFieldValue("userInfoEndpoint",i.data.userinfo_endpoint))},z=(s,a)=>{O(String(a.issuer));for(const i in a)if(a[i]==null){b(!0);return}b(!1)},L=t.name?{id:r.id,clientId:r.clientId,clientSecret:r.clientSecret,issuer:r.issuer,jwks:r.jwks,jwksJSON:r.jwksJSON,jwksURL:r.jwksURL,userInfoEndpoint:r.userInfoEndpoint,switchState:t.switchState}:{id:"",clientId:"",clientSecret:"",issuer:"",jwks:0,jwksJSON:"",jwksURL:"",userInfoEndpoint:"",switchState:[]},h=({updated_src:s})=>{I(JSON.stringify(s))};return d($,{children:[e("div",{className:`${_["db-check-setting"]}  mt-2 cursor-pointer`,children:e("span",{className:" h-5 w-19 float-right"})}),e("div",{className:`${_["edit-form-contain"]} py-6 rounded-xl mb-4`,children:d(n,{form:l,style:{width:"90%"},name:"basic",labelCol:{span:4},wrapperCol:{span:11},onFinish:s=>{J(s)},onValuesChange:z,autoComplete:"new-password",validateTrigger:"onBlur",initialValues:L,children:[e(n.Item,{label:"\u4F9B\u5E94\u5546ID",name:"id",rules:[{required:!0,message:"\u4F9B\u5E94\u5546ID\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^\\w+$","g"),message:"\u53EA\u5141\u8BB8\u5305\u542B\u5B57\u6BCD\uFF0C\u6570\u5B57\uFF0C\u4E0B\u5212\u7EBF"}],children:e(o,{placeholder:"\u8BF7\u8F93\u5165...",autoComplete:"off",autoFocus:!0})}),e(n.Item,{label:"App ID",name:"clientId",rules:[{required:!0,message:"App ID\u4E0D\u80FD\u4E3A\u7A7A"}],children:e(o,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(n.Item,{label:"App Secret",name:"clientSecret",rules:[{required:!0,message:"App Secret\u4E0D\u80FD\u4E3A\u7A7A"}],children:e(o.Password,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(n.Item,{label:"Issuer",name:"issuer",rules:[{required:!0,message:"Issuer\u4E0D\u80FD\u4E3A\u7A7A"},{type:"url",message:"\u53EA\u5141\u8BB8\u8F93\u5165\u94FE\u63A5"}],children:e(o,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(n.Item,{label:"\u670D\u52A1\u53D1\u73B0\u5730\u5740",children:e(o,{value:`${B}/.well-known/openid-configuration`,disabled:!0})}),e(n.Item,{label:"JWKS",name:"jwks",children:d(F.Group,{onChange:s=>{R(s.target.value)},value:D,children:[e(F,{value:0,children:"URL"}),e(F,{value:1,children:"JSON"})]})}),C?e(n.Item,{label:"jwksJSON",className:"mb-5",children:e(G,{onEdit:h,onAdd:h,onDelete:h,src:S,iconStyle:"triangle",name:!1})}):e(n.Item,{label:"jwksURL",name:"jwksURL",children:e(o,{disabled:!0,suffix:"\u6D4F\u89C8"})}),e(n.Item,{label:"\u7528\u6237\u7AEF\u70B9",name:"userInfoEndpoint",children:e(o,{disabled:!0})}),e(n.Item,{label:"\u662F\u5426\u5F00\u542F",name:"switchState",children:e(V.Group,{options:M})}),d(n.Item,{wrapperCol:{offset:4,span:16},children:[e(g,{className:"btn-cancel",onClick:()=>{if(!(t!=null&&t.id)){N(-1);return}k("data",t.id)},children:e("span",{children:"\u53D6\u6D88"})}),e(g,{className:"ml-4 btn-test",onClick:j,children:"\u6D4B\u8BD5"}),e(g,{className:"ml-4 btn-save",onClick:()=>{l.submit()},children:"\u4FDD\u5B58"})]})]})})]})}const H="_select_usz5y_1",Q="_actions_usz5y_4",X="_manage_usz5y_9",he={select:H,actions:Q,manage:X,"option-icon":"_option-icon_usz5y_12","select-contain":"_select-contain_usz5y_18","delete-label":"_delete-label_usz5y_25","save-btn":"_save-btn_usz5y_28","connect-check-btn-common":"_connect-check-btn-common_usz5y_46","user-info":"_user-info_usz5y_56"};export{pe as A,he as s};

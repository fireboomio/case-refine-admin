import{r as d,a as t,A as yt,g as We,aA as it,j as f,F as K,aa as L,a9 as R,aB as Et,b as le,ax as st,u as pe,n as je,aw as kt,O as At}from"./index.64257940.js";import{A as Ee}from"./index.ddb16e05.js";import{M as Ae}from"./index.46a9404e.js";import{B as _t}from"./button.ca276c4e.js";import{i as se}from"./use-immer.module.72e4ecef.js";import{I as de}from"./index.93b57069.js";import{R as Ne,T as xt}from"./Tree.0082570b.js";import{E as Ft}from"./iconUtil.71342ca5.js";import{S as Ct}from"./index.1337bcbe.js";import{S as Re}from"./index.21d0aee3.js";import{u as Nt,_ as Bt}from"./stackblitz.d6583d31.js";import{d as ke}from"./dayjs.min.9104a23a.js";import{d as St}from"./duration.d1df7432.js";import{S as X}from"./interface.b1c17552.js";import{m as nt,i as Be,a as at}from"./utils.435ff07e.js";import{W as ce}from"./workbenchContext.4d536977.js";import{I as Dt,e as ze}from"./index.bf34cfca.js";import{i as zt,u as ot}from"./index.esm.a8235609.js";import{m as It,e as Rt,D as rt,f as Mt,a as He,P as fe,u as $t,b as Tt,c as Lt,s as q,M as Ot,d as Me,g as lt,h as ct,E as Pt,i as Wt,j as me,U as qe,k as jt}from"./pannel.module.ef4500e4.js";/* empty css               */import"./index.61964446.js";import{P as Ht}from"./index.2fd29b41.js";import{T as ne}from"./styleChecker.9486324a.js";import{r as oe}from"./index.27788710.js";import{p as qt}from"./prisma-ast.esm.01fc1dd4.js";/* empty css               */import{D as _e,M as xe}from"./index.e257c064.js";import{P as $e}from"./index.396a50a9.js";import{I as he}from"./index.2b25ba57.js";import{I as Yt}from"./index.90bee82c.js";import"./Sider.4bd14ece.js";import"./RightOutlined.ce6e99f7.js";import"./omit.173224d8.js";import"./Portal.bf2e5144.js";import"./type.4482a080.js";import"./DialogWrap.ed68ac9f.js";import"./pickAttrs.91b30b21.js";import"./context.4fcda71f.js";import"./_baseIsEqual.ae1f3f6e.js";import"./statusUtils.e7207d24.js";import"./EyeOutlined.8d71b64e.js";import"./SearchOutlined.d2d234c2.js";import"./isSymbol.d728fe31.js";import"./index.39cec35d.js";import"./conductUtil.91a30912.js";import"./Overflow.ff04d686.js";import"./row.04cc9265.js";import"./responsiveObserve.a761adf9.js";import"./isArrayLikeObject.9676d780.js";import"./get.ab779695.js";import"./identity.af5bbf98.js";import"./_copyArray.ed92a2fd.js";import"./index.9d56ca15.js";import"./index.4ef503cf.js";import"./parser.542c3b4e.js";import"./_createAggregator.7c8a2c66.js";import"./keyBy.5e811ab6.js";import"./tslib.es6.d40f4976.js";import"./Dropdown.66094b27.js";import"./css.7dd30b7b.js";var Ut={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"}}]},name:"form",theme:"outlined"};const Vt=Ut;var ut=function(a,e){return t(yt,{...We(We({},a),{},{ref:e,icon:Vt})})};ut.displayName="FormOutlined";const Kt=d.exports.forwardRef(ut);ke.extend(St);function Ye(i){const a=ke.duration(ke().diff(ke(i),"seconds"),"seconds");return a.$d.days>0?`${a.$d.days}\u5929\u524D`:a.$d.hours>0?`${a.$d.hours}\u5C0F\u65F6\u524D`:a.$d.minutes>0?`${a.$d.minutes}\u5206\u949F\u524D`:a.$d.seconds>0?`${a.$d.seconds}\u79D2\u524D`:"\u521A\u521A"}const Gt="_info_1xof0_9",Jt="_gitIcon_1xof0_17",Zt="_errLabel_1xof0_23",Xt="_split_1xof0_27",Qt="_hookEntry_1xof0_33",ei="_statusLabel_1xof0_36",ti="_hookMask_1xof0_39",ii="_hookContainer_1xof0_47",H={"status-bar":"_status-bar_1xof0_1",info:Gt,gitIcon:Jt,errLabel:Zt,split:Xt,hookEntry:Qt,statusLabel:ei,hookMask:ti,hookContainer:ii},{Option:Ue}=Re,Ve={[X.Compiling]:"\u7F16\u8BD1\u4E2D",[X.Starting]:"\u542F\u52A8\u4E2D",[X.Running]:"\u5DF2\u542F\u52A8",[X.CompileFail]:"\u7F16\u8BD1\u5931\u8D25",[X.StartFail]:"\u542F\u52A8\u5931\u8D25"},si=({className:i,env:a,version:e,startTime:s,errorInfo:n,engineStatus:o,hookStatus:r,toggleWindow:u})=>{var v,I,W,j;const[l,c]=d.exports.useState(),[p,g]=d.exports.useState(),[E,_]=d.exports.useState(),[b,k]=d.exports.useState(),[S,M]=d.exports.useState(),{config:$,refreshConfig:B}=it(),{openHookServer:x,loading:m}=Nt();d.exports.useEffect(()=>{var Y;const[C,N,T]=((Y=$==null?void 0:$.hooksServerURL)==null?void 0:Y.match(/^(https?:\/\/)?(.*)$/))||[];_(!!$.hooksServerURL),k(T),M(N==="http://"?"http://":"https://")},[$.hooksServerURL,p]),d.exports.useEffect(()=>{if(!s)return;c(Ye(s));const C=setInterval(()=>{c(Ye(s))},6e4);return()=>{clearInterval(C)}},[s]);async function D(C){R.post("/setting",{key:"hooksServerURL",val:C}).then(()=>{B()})}const w=d.exports.useCallback(()=>{x()},[]);return t("div",{className:i,children:t("div",{className:H["status-bar"],children:f("span",{className:H.info,children:[t("span",{className:H.gitIcon}),t("span",{className:"mr-12",children:"CONNECT GIT (BETA)"}),t("span",{className:H["info-env"]+" mr-2",children:t("span",{children:a})}),f("span",{className:H["info-version"]+" mr-2",children:[t("span",{children:"FB:"}),t("span",{className:"",children:e})]}),t("span",{onClick:()=>{u("0")},className:H.errLabel+" mr-2 cursor-pointer",children:t("span",{children:"\u65E5\u5FD7"})}),f("span",{onClick:()=>{u("1")},className:"cursor-pointer flex items-center",children:[f("span",{className:H.errLabel,children:[t("img",{height:14,width:14,src:"/assets/workbench/footer-error.png",alt:"\u9519\u8BEF"}),t("span",{className:"ml-2",children:(v=n==null?void 0:n.errTotal)!=null?v:0})]}),f("span",{className:H.errLabel,style:{marginLeft:8},children:[t("img",{height:14,width:14,src:"/assets/workbench/footer-warning.png",alt:"\u8B66\u544A"}),t("span",{className:"ml-2",children:(I=n==null?void 0:n.warnTotal)!=null?I:0})]})]}),t("span",{className:"ml-8",children:"\u5F15\u64CE\u72B6\u6001\uFF1A"}),f("span",{className:H.errLabel,children:[t("div",{className:"bg-[#50C772] rounded-3px h-3px w-3px"}),t("span",{className:"ml-1 text-[#50C772]",children:(W=Ve[o])!=null?W:""})]}),t("span",{className:"ml-4.5",children:"\u94A9\u5B50\u72B6\u6001\uFF1A"}),f("span",{className:H.errLabel+" cursor-pointer",children:[f("div",{className:"flex h-full items-center",onClick:()=>{!$.hooksServerURL&&!m&&w()},children:[t("div",{className:"bg-[#50C772] rounded-3px h-3px w-3px"}),t("span",{className:"ml-1 text-[#50C772]",children:(j=Ve[r])!=null?j:""})]}),t("div",{className:H.split}),f("div",{className:"flex h-full items-center",onClick:()=>g(!0),children:[t("div",{className:H.hookEntry,children:$.hooksServerURL||"WebContainer"}),t("div",{className:"mr-5px ml-8px",style:{transform:p?"rotate(180deg)":""},children:t("img",{alt:"",src:"/assets/hook-arrow.svg"})})]}),p&&f(K,{children:[t("div",{className:H.hookMask,onClick:C=>{C.stopPropagation(),g(!1)}}),f("div",{className:H.hookContainer+" common-form",onClick:C=>{C.stopPropagation()},children:[t(Ne.Group,{onChange:C=>{_(C.target.value),D(""),C.target.value&&L.info("\u8BF7\u624B\u52A8\u542F\u52A8\u94A9\u5B50\uFF0C\u5E76\u4FDD\u8BC1\u914D\u7F6E\u6B63\u786E")},value:E,children:f(Ct,{direction:"vertical",children:[t(Ne,{value:!1,children:"WebContainer"}),t(Ne,{value:!0,children:"\u624B\u52A8\u8BBE\u7F6E"})]})}),f(de.Group,{compact:!0,children:[f(Re,{className:"w-2/5",popupClassName:"!z-13000",value:S,onChange:M,children:[t(Ue,{value:"https://",children:"https://"}),t(Ue,{value:"http://",children:"http://"})]}),t(de,{style:{width:"60%"},className:H.hookInput,value:b,onChange:C=>k(C.target.value),onPressEnter:()=>{E&&(D(`${S}${b!=null?b:""}`),g(!1))},onBlur:()=>{E&&(D(`${S}${b!=null?b:""}`),g(!1))}})]})]})]})]}),t("span",{className:"ml-4.5",children:"\u7F16\u8BD1\u65F6\u95F4\uFF1A"}),t("span",{className:H.errLabel,children:t("span",{className:"ml-1 text-[#649FFF]",children:l})})]})})})},ni=si;var ai=globalThis&&globalThis.__extends||function(){var i=function(a,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,n){s.__proto__=n}||function(s,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s[o]=n[o])},i(a,e)};return function(a,e){i(a,e);function s(){this.constructor=a}a.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),P=globalThis&&globalThis.__assign||function(){return P=Object.assign||function(i){for(var a,e=1,s=arguments.length;e<s;e++){a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i[n]=a[n])}return i},P.apply(this,arguments)},Ke={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},Ge={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},ge={width:"20px",height:"20px",position:"absolute"},oi={top:P(P({},Ke),{top:"-5px"}),right:P(P({},Ge),{left:void 0,right:"-5px"}),bottom:P(P({},Ke),{top:void 0,bottom:"-5px"}),left:P(P({},Ge),{left:"-5px"}),topRight:P(P({},ge),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:P(P({},ge),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:P(P({},ge),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:P(P({},ge),{left:"-10px",top:"-10px",cursor:"nw-resize"})},ri=function(i){ai(a,i);function a(){var e=i!==null&&i.apply(this,arguments)||this;return e.onMouseDown=function(s){e.props.onResizeStart(s,e.props.direction)},e.onTouchStart=function(s){e.props.onResizeStart(s,e.props.direction)},e}return a.prototype.render=function(){return t("div",{className:this.props.className||"",style:P(P({position:"absolute",userSelect:"none"},oi[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart,children:this.props.children})},a}(d.exports.PureComponent),li=globalThis&&globalThis.__extends||function(){var i=function(a,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,n){s.__proto__=n}||function(s,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s[o]=n[o])},i(a,e)};return function(a,e){i(a,e);function s(){this.constructor=a}a.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),Z=globalThis&&globalThis.__assign||function(){return Z=Object.assign||function(i){for(var a,e=1,s=arguments.length;e<s;e++){a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i[n]=a[n])}return i},Z.apply(this,arguments)},ci={width:"auto",height:"auto"},ve=function(i,a,e){return Math.max(Math.min(i,e),a)},Je=function(i,a){return Math.round(i/a)*a},re=function(i,a){return new RegExp(i,"i").test(a)},be=function(i){return Boolean(i.touches&&i.touches.length)},ui=function(i){return Boolean((i.clientX||i.clientX===0)&&(i.clientY||i.clientY===0))},Ze=function(i,a,e){e===void 0&&(e=0);var s=a.reduce(function(o,r,u){return Math.abs(r-i)<Math.abs(a[o]-i)?u:o},0),n=Math.abs(a[s]-i);return e===0||n<e?a[s]:i},Se=function(i){return i=i.toString(),i==="auto"||i.endsWith("px")||i.endsWith("%")||i.endsWith("vh")||i.endsWith("vw")||i.endsWith("vmax")||i.endsWith("vmin")?i:i+"px"},we=function(i,a,e,s){if(i&&typeof i=="string"){if(i.endsWith("px"))return Number(i.replace("px",""));if(i.endsWith("%")){var n=Number(i.replace("%",""))/100;return a*n}if(i.endsWith("vw")){var n=Number(i.replace("vw",""))/100;return e*n}if(i.endsWith("vh")){var n=Number(i.replace("vh",""))/100;return s*n}}return i},hi=function(i,a,e,s,n,o,r){return s=we(s,i.width,a,e),n=we(n,i.height,a,e),o=we(o,i.width,a,e),r=we(r,i.height,a,e),{maxWidth:typeof s>"u"?void 0:Number(s),maxHeight:typeof n>"u"?void 0:Number(n),minWidth:typeof o>"u"?void 0:Number(o),minHeight:typeof r>"u"?void 0:Number(r)}},di=["as","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],Xe="__resizable_base__",pi=function(i){li(a,i);function a(e){var s=i.call(this,e)||this;return s.ratio=1,s.resizable=null,s.parentLeft=0,s.parentTop=0,s.resizableLeft=0,s.resizableRight=0,s.resizableTop=0,s.resizableBottom=0,s.targetLeft=0,s.targetTop=0,s.appendBase=function(){if(!s.resizable||!s.window)return null;var n=s.parentNode;if(!n)return null;var o=s.window.document.createElement("div");return o.style.width="100%",o.style.height="100%",o.style.position="absolute",o.style.transform="scale(0, 0)",o.style.left="0",o.style.flex="0 0 100%",o.classList?o.classList.add(Xe):o.className+=Xe,n.appendChild(o),o},s.removeBase=function(n){var o=s.parentNode;!o||o.removeChild(n)},s.ref=function(n){n&&(s.resizable=n)},s.state={isResizing:!1,width:typeof(s.propsSize&&s.propsSize.width)>"u"?"auto":s.propsSize&&s.propsSize.width,height:typeof(s.propsSize&&s.propsSize.height)>"u"?"auto":s.propsSize&&s.propsSize.height,direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},s.onResizeStart=s.onResizeStart.bind(s),s.onMouseMove=s.onMouseMove.bind(s),s.onMouseUp=s.onMouseUp.bind(s),s}return Object.defineProperty(a.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||ci},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"size",{get:function(){var e=0,s=0;if(this.resizable&&this.window){var n=this.resizable.offsetWidth,o=this.resizable.offsetHeight,r=this.resizable.style.position;r!=="relative"&&(this.resizable.style.position="relative"),e=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:n,s=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:o,this.resizable.style.position=r}return{width:e,height:s}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"sizeStyle",{get:function(){var e=this,s=this.props.size,n=function(u){if(typeof e.state[u]>"u"||e.state[u]==="auto")return"auto";if(e.propsSize&&e.propsSize[u]&&e.propsSize[u].toString().endsWith("%")){if(e.state[u].toString().endsWith("%"))return e.state[u].toString();var l=e.getParentSize(),c=Number(e.state[u].toString().replace("px","")),p=c/l[u]*100;return p+"%"}return Se(e.state[u])},o=s&&typeof s.width<"u"&&!this.state.isResizing?Se(s.width):n("width"),r=s&&typeof s.height<"u"&&!this.state.isResizing?Se(s.height):n("height");return{width:o,height:r}},enumerable:!1,configurable:!0}),a.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var e=this.appendBase();if(!e)return{width:0,height:0};var s=!1,n=this.parentNode.style.flexWrap;n!=="wrap"&&(s=!0,this.parentNode.style.flexWrap="wrap"),e.style.position="relative",e.style.minWidth="100%",e.style.minHeight="100%";var o={width:e.offsetWidth,height:e.offsetHeight};return s&&(this.parentNode.style.flexWrap=n),this.removeBase(e),o},a.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},a.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},a.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var e=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:e.flexBasis!=="auto"?e.flexBasis:void 0})}},a.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},a.prototype.createSizeForCssProperty=function(e,s){var n=this.propsSize&&this.propsSize[s];return this.state[s]==="auto"&&this.state.original[s]===e&&(typeof n>"u"||n==="auto")?"auto":e},a.prototype.calculateNewMaxFromBoundary=function(e,s){var n=this.props.boundsByDirection,o=this.state.direction,r=n&&re("left",o),u=n&&re("top",o),l,c;if(this.props.bounds==="parent"){var p=this.parentNode;p&&(l=r?this.resizableRight-this.parentLeft:p.offsetWidth+(this.parentLeft-this.resizableLeft),c=u?this.resizableBottom-this.parentTop:p.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(l=r?this.resizableRight:this.window.innerWidth-this.resizableLeft,c=u?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(l=r?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),c=u?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return l&&Number.isFinite(l)&&(e=e&&e<l?e:l),c&&Number.isFinite(c)&&(s=s&&s<c?s:c),{maxWidth:e,maxHeight:s}},a.prototype.calculateNewSizeFromDirection=function(e,s){var n=this.props.scale||1,o=this.props.resizeRatio||1,r=this.state,u=r.direction,l=r.original,c=this.props,p=c.lockAspectRatio,g=c.lockAspectRatioExtraHeight,E=c.lockAspectRatioExtraWidth,_=l.width,b=l.height,k=g||0,S=E||0;return re("right",u)&&(_=l.width+(e-l.x)*o/n,p&&(b=(_-S)/this.ratio+k)),re("left",u)&&(_=l.width-(e-l.x)*o/n,p&&(b=(_-S)/this.ratio+k)),re("bottom",u)&&(b=l.height+(s-l.y)*o/n,p&&(_=(b-k)*this.ratio+S)),re("top",u)&&(b=l.height-(s-l.y)*o/n,p&&(_=(b-k)*this.ratio+S)),{newWidth:_,newHeight:b}},a.prototype.calculateNewSizeFromAspectRatio=function(e,s,n,o){var r=this.props,u=r.lockAspectRatio,l=r.lockAspectRatioExtraHeight,c=r.lockAspectRatioExtraWidth,p=typeof o.width>"u"?10:o.width,g=typeof n.width>"u"||n.width<0?e:n.width,E=typeof o.height>"u"?10:o.height,_=typeof n.height>"u"||n.height<0?s:n.height,b=l||0,k=c||0;if(u){var S=(E-b)*this.ratio+k,M=(_-b)*this.ratio+k,$=(p-k)/this.ratio+b,B=(g-k)/this.ratio+b,x=Math.max(p,S),m=Math.min(g,M),D=Math.max(E,$),w=Math.min(_,B);e=ve(e,x,m),s=ve(s,D,w)}else e=ve(e,p,g),s=ve(s,E,_);return{newWidth:e,newHeight:s}},a.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var e=this.parentNode;if(e){var s=e.getBoundingClientRect();this.parentLeft=s.left,this.parentTop=s.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var n=this.props.bounds.getBoundingClientRect();this.targetLeft=n.left,this.targetTop=n.top}if(this.resizable){var o=this.resizable.getBoundingClientRect(),r=o.left,u=o.top,l=o.right,c=o.bottom;this.resizableLeft=r,this.resizableRight=l,this.resizableTop=u,this.resizableBottom=c}},a.prototype.onResizeStart=function(e,s){if(!(!this.resizable||!this.window)){var n=0,o=0;if(e.nativeEvent&&ui(e.nativeEvent)?(n=e.nativeEvent.clientX,o=e.nativeEvent.clientY):e.nativeEvent&&be(e.nativeEvent)&&(n=e.nativeEvent.touches[0].clientX,o=e.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var r=this.props.onResizeStart(e,s,this.resizable);if(r===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var u,l=this.window.getComputedStyle(this.resizable);if(l.flexBasis!=="auto"){var c=this.parentNode;if(c){var p=this.window.getComputedStyle(c).flexDirection;this.flexDir=p.startsWith("row")?"row":"column",u=l.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var g={original:{x:n,y:o,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:Z(Z({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(e.target).cursor||"auto"}),direction:s,flexBasis:u};this.setState(g)}},a.prototype.onMouseMove=function(e){var s=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&be(e))try{e.preventDefault(),e.stopPropagation()}catch{}var n=this.props,o=n.maxWidth,r=n.maxHeight,u=n.minWidth,l=n.minHeight,c=be(e)?e.touches[0].clientX:e.clientX,p=be(e)?e.touches[0].clientY:e.clientY,g=this.state,E=g.direction,_=g.original,b=g.width,k=g.height,S=this.getParentSize(),M=hi(S,this.window.innerWidth,this.window.innerHeight,o,r,u,l);o=M.maxWidth,r=M.maxHeight,u=M.minWidth,l=M.minHeight;var $=this.calculateNewSizeFromDirection(c,p),B=$.newHeight,x=$.newWidth,m=this.calculateNewMaxFromBoundary(o,r);this.props.snap&&this.props.snap.x&&(x=Ze(x,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(B=Ze(B,this.props.snap.y,this.props.snapGap));var D=this.calculateNewSizeFromAspectRatio(x,B,{width:m.maxWidth,height:m.maxHeight},{width:u,height:l});if(x=D.newWidth,B=D.newHeight,this.props.grid){var w=Je(x,this.props.grid[0]),v=Je(B,this.props.grid[1]),I=this.props.snapGap||0;x=I===0||Math.abs(w-x)<=I?w:x,B=I===0||Math.abs(v-B)<=I?v:B}var W={width:x-_.width,height:B-_.height};if(b&&typeof b=="string"){if(b.endsWith("%")){var j=x/S.width*100;x=j+"%"}else if(b.endsWith("vw")){var C=x/this.window.innerWidth*100;x=C+"vw"}else if(b.endsWith("vh")){var N=x/this.window.innerHeight*100;x=N+"vh"}}if(k&&typeof k=="string"){if(k.endsWith("%")){var j=B/S.height*100;B=j+"%"}else if(k.endsWith("vw")){var C=B/this.window.innerWidth*100;B=C+"vw"}else if(k.endsWith("vh")){var N=B/this.window.innerHeight*100;B=N+"vh"}}var T={width:this.createSizeForCssProperty(x,"width"),height:this.createSizeForCssProperty(B,"height")};this.flexDir==="row"?T.flexBasis=T.width:this.flexDir==="column"&&(T.flexBasis=T.height),Et.exports.flushSync(function(){s.setState(T)}),this.props.onResize&&this.props.onResize(e,E,this.resizable,W)}},a.prototype.onMouseUp=function(e){var s=this.state,n=s.isResizing,o=s.direction,r=s.original;if(!(!n||!this.resizable)){var u={width:this.size.width-r.width,height:this.size.height-r.height};this.props.onResizeStop&&this.props.onResizeStop(e,o,this.resizable,u),this.props.size&&this.setState(this.props.size),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:Z(Z({},this.state.backgroundStyle),{cursor:"auto"})})}},a.prototype.updateSize=function(e){this.setState({width:e.width,height:e.height})},a.prototype.renderResizer=function(){var e=this,s=this.props,n=s.enable,o=s.handleStyles,r=s.handleClasses,u=s.handleWrapperStyle,l=s.handleWrapperClass,c=s.handleComponent;if(!n)return null;var p=Object.keys(n).map(function(g){return n[g]!==!1?t(ri,{direction:g,onResizeStart:e.onResizeStart,replaceStyles:o&&o[g],className:r&&r[g],children:c&&c[g]?c[g]:null},g):null});return t("div",{className:l,style:u,children:p})},a.prototype.render=function(){var e=this,s=Object.keys(this.props).reduce(function(r,u){return di.indexOf(u)!==-1||(r[u]=e.props[u]),r},{}),n=Z(Z(Z({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(n.flexBasis=this.state.flexBasis);var o=this.props.as||"div";return f(o,{...Z({ref:this.ref,style:n,className:this.props.className},s),children:[this.state.isResizing&&t("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer()]})},a.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},a}(d.exports.PureComponent);const fi="_block_gj6ak_1",mi="_line_gj6ak_8",gi="_icon_gj6ak_13",vi="_name_gj6ak_18",bi="_desc_gj6ak_24",wi="_action_gj6ak_36",G={block:fi,line:mi,icon:gi,name:vi,desc:bi,action:wi};function yi(){const[i,a]=d.exports.useState([]),{onRefreshMenu:e}=d.exports.useContext(ce);d.exports.useEffect(()=>{R.get("wdg/question").then(l=>{a(Object.keys(l).map(c=>(l[c].forEach(p=>{c==="datasource"?["mysql","pgsql","mongodb","sqlite","rest","graphql"].includes(p.type)?p.icon=`/assets/icon/${p.type}.svg`:p.icon="/assets/icon/db-other.svg":["api","storage"].includes(c)?p.icon="/assets/icon/file.svg":p.icon="/assets/icon/github-fill.svg"}),{key:c,list:l[c]})))})},[]);const s=le();async function n(l){const c=await R.get(`/dataSource/${l}`);c!=null&&c.id&&(await R.put("/dataSource",{...c,switch:0}),e("dataSource"))}async function o(l){const c=await R.get(`/operateApi/${l}`);c!=null&&c.id&&(await R.put("/operateApi",{...c,enable:!1}),e("api"))}async function r(l){const c=await R.get(`/auth/${l}`);c!=null&&c.id&&(await R.put("/auth",{...c,switch:0}),e("auth"))}async function u(l){const c=await R.get(`/storageBucket/${l}`);c!=null&&c.id&&(await R.put("/storageBucket",{...c,switch:0}),e("storage"))}return f("div",{children:[!i.length&&t(Ft,{className:"pt-20",description:"\u6682\u65E0\u95EE\u9898"}),i.map((l,c)=>t("div",{className:G.block,children:l.list.map(p=>f("div",{className:G.line,children:[t("img",{src:p.icon,className:G.icon,alt:""}),t("div",{className:G.name,children:p.name}),f("div",{className:G.desc,children:[t("span",{children:p.reasonMsg}),l.key==="datasource"&&t(K,{children:f("span",{children:["\uFF0C\u53EF",t("span",{className:G.action,onClick:()=>s(`/workbench/datasource/${p.id}`),children:"\u524D\u5F80"}),"\u6392\u67E5\uFF0C\u6216",t("span",{className:G.action,onClick:()=>n(p.id),children:"\u5173\u95ED"}),"\u8BE5\u6570\u636E\u6E90"]})}),l.key==="api"&&t(K,{children:f("span",{children:["\uFF0C\u53EF",t("span",{className:G.action,onClick:()=>s(`/workbench/apimanage/${p.id}`),children:"\u524D\u5F80"}),"\u7F16\u8F91",p.switch&&f(K,{children:["\uFF0C\u6216",t("span",{className:G.action,onClick:()=>o(p.id),children:"\u5173\u95ED"}),"\u8BE5API"]})]})}),l.key==="auth"&&t(K,{children:f("span",{children:["\uFF0C\u53EF",t("span",{className:G.action,onClick:()=>s(`/workbench/auth/${p.id}`),children:"\u524D\u5F80"}),"\u7F16\u8F91",p.switch&&f(K,{children:["\uFF0C\u6216",t("span",{className:G.action,onClick:()=>r(p.id),children:"\u5173\u95ED"}),"\u8BE5\u9A8C\u8BC1\u5668"]})]})}),l.key==="storage"&&t(K,{children:f("span",{children:["\uFF0C\u53EF",t("span",{className:G.action,onClick:()=>s(`/workbench/storage/${p.id}`),children:"\u524D\u5F80"}),"\u7F16\u8F91",p.switch&&f(K,{children:["\uFF0C\u6216",t("span",{className:G.action,onClick:()=>u(p.id),children:"\u5173\u95ED"}),"\u8BE5\u5BF9\u8C61\u5B58\u50A8"]})]})})]})]},p.id))},c))]})}const Ei=({actionRef:i})=>{const[a,e]=d.exports.useState([]),s=d.exports.useRef(null);return d.exports.useEffect(()=>{var n;(n=s.current)==null||n.scrollIntoView({behavior:"smooth"})},[a]),d.exports.useEffect(()=>{i&&(i.current={appendLogs(n){e([...a,...n.map(o=>({...o,logType:o.logType||1}))])},clearLogs(){e([])},downloadLogs(){const n=new File([a.map(u=>JSON.stringify(u)).join(`
`)],"logs.txt",{type:"text/plain"}),o=document.createElement("a"),r=URL.createObjectURL(n);o.href=r,o.download=n.name,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r)}})},[i,a]),t("div",{className:"flex flex-1 w-full overflow-hidden",children:f("div",{className:"h-full mb-0 w-10/10 overflow-auto",children:[a.map((n,o)=>f("div",{className:"text-xs leading-25px font-normal text-[#333333]",children:[t("span",{className:"mr-8",children:n.time})," ",t("span",{className:"mr-1.5",children:t("img",{src:n.logType===1?"/assets/log-core.svg":"/assets/log-hook.svg",alt:n.logType===1?"\u6838\u5FC3\u65E5\u5FD7":"\u94A9\u5B50\u65E5\u5FD7"})}),t("span",{className:"w-100 mr-1",children:n.level})," ",t("span",{children:n.msg})]},o)),t("div",{ref:s})]})})},ki="_active_1cb5p_1",Ai="_divider_1cb5p_17",_i={active:ki,divider:Ai},xi=i=>{var o;const[a,e]=d.exports.useState((o=i.activeKey)!=null?o:i.tabs[0].key),s=d.exports.useCallback(r=>{var u;e(r),(u=i.onTabClick)==null||u.call(i,r)},[i]),n=d.exports.useCallback(r=>i.activeKey?i.activeKey===r:a===r,[i.activeKey,a]);return t("div",{className:i.className,children:f("div",{className:"flex justify-between",children:[t("div",{className:"flex space-x-6",children:i.tabs.map(r=>t("div",{className:`text-[#252B3A]  cursor-pointer leading-20px ${n(r.key)?_i.active:""}`,onClick:()=>s(r.key),children:r.title},r.key))}),i.extra]})})},Fi=[{title:"\u65E5\u5FD7",key:"0"},{title:"\u95EE\u9898",key:"1"}],Ci=({style:i,toggleWindow:a,defaultTab:e})=>{var l;const[s,n]=d.exports.useState(e!=null?e:"0"),o=d.exports.useRef(),r=d.exports.useRef();d.exports.useEffect(()=>{const c=new AbortController,p=c.signal;async function g(){var E;if(!r.current){r.current=await fetch("/api/v1/wdg/log",{signal:p});const _=r.current.body.getReader(),b=new TextDecoder;let k=await _.read();for(;!k.done;){const S=b.decode(k.value),M=nt(S);(E=o.current)==null||E.appendLogs(M),k=await _.read()}console.log("Log finished")}}return g(),()=>{console.log("close fetch"),c.abort()}},[]);const u=f("div",{className:"cursor-pointer flex justify-end",children:[t("div",{onClick:()=>{var c;return(c=o.current)==null?void 0:c.clearLogs()},children:t("img",{src:"/assets/clear.svg",height:20,width:20,alt:"\u6E05\u7A7A"})}),t("div",{className:"ml-4",onClick:(l=o.current)==null?void 0:l.downloadLogs,children:t("img",{src:"/assets/download2.svg",height:20,width:20,alt:"\u4E0B\u8F7D"})}),t("div",{className:"ml-4",onClick:a,children:t("img",{src:"/assets/close2.svg",height:20,width:20,alt:"\u5173\u95ED"})})]});return t("div",{className:"bg-[#fff] border-gray-500/50 min-h-80px pb-5 px-7 bottom-36px z-1200  absolute",style:{borderTop:"1px solid #EFEFEFFF",borderRadius:"12px 12px 0 0",overflow:"hidden",...i},children:f(pi,{className:"flex flex-col h-full pt-2.5",defaultSize:{width:"100%",height:348},minWidth:"100%",maxWidth:"100%",enable:{top:!0},children:[t(xi,{tabs:Fi,onTabClick:n,activeKey:s,extra:u,className:"pb-2.5"}),f("div",{className:`w-full overflow-auto ${s==="0"?"":"hidden"}`,children:[t(Ei,{actionRef:o})," "]}),t("div",{className:`w-full overflow-auto ${s==="1"?"":"hidden"}`,children:t(yi,{})})]})})},Ni=Ci,Bi=i=>{const a=d.exports.useRef(),{id:e}=st(),[s,n]=d.exports.useReducer(It,Rt.state),{newMap:o,delMap:r,editMap:u}=s,[l,c]=se("preview"),[p,g]=se(!1),[E,_]=se([]),{data:b,error:k}=zt(rt,Mt),[S,M]=se(null),[$,B]=se(!1);d.exports.useEffect(()=>{var v;_((v=b==null?void 0:b.filter(I=>I.sourceType===1))!=null?v:[])},[b,_]),d.exports.useEffect(()=>{var v;if(a.current=e,E.length>0&&e){const I=L.loading("\u52A0\u8F7D\u4E2D...",0);(v=He(Number(e),n,E,a))==null||v.finally(()=>{I(),B(!$)})}},[E,e]),d.exports.useEffect(()=>{s.blocks.length&&!s.blocks.find(v=>["model","enum"].includes(v.type))&&(c("editModel"),g(!0))},[s.blocks]);const x=v=>{var W;const I=L.loading("\u52A0\u8F7D\u4E2D...",0);(W=He(v,n,E,a))==null||W.finally(()=>{I()})},m=(v,I=!1)=>{!v||(M(v),p?c(v.type==="model"?"editModel":"editEnum"):(c((v==null?void 0:v.type)==="enum"?"editEnum":"preview"),n($t([]))),n(Tt(v.id)))},D=m;d.exports.useEffect(()=>{var v;S?m(S,!0):((v=s.blocks)==null?void 0:v.length)>0&&m(s.blocks.find(I=>I.type==="model"||I.type==="enum"),!0)},[p,s.blocks]);const w=v=>{if(p&&Object.keys({...o,...r,...u}).length>0){L.error("\u8BF7\u5148\u4FDD\u5B58\u6216\u53D6\u6D88\u7F16\u8F91");return}g(v)};return t(fe.Provider,{value:{state:s,syncEditorFlag:$,triggerSyncEditor:()=>B(!$),dispatch:n,panel:{inEdit:p,handleSetInEdit:w,handleToggleDesigner:D,handleClickEntity:m,handleChangeSource:x,setShowType:c,dataSources:E,showType:l}},children:i.children})},Si=Bi,Di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACoAAAAoCAMAAAC/1ZhiAAAA7VBMVEUAAACAhI2BhI2EiJCAhI2AhI2AhIx4foiAhI2Ag41fY2qAhI7f39+Ch4yAmZnb29vb29tiZWyCho7g4ODb29tiZGtfYmpfYmmAhY2BhYxiYmpjaGx0eH/Ky8xlZ2/c3NyAg42AhIxgY2qAhIxydX1gZGtgY2mAg41jZWutr7NhY2pfZGqBhI9hZGqdoKPe3t5iYmxgZG1fZGljY2vb29t/g4xfYmnV1ta5u76PkprOz9Cgo6mUlp2Hi5Kpq7DKysx2eoK8vb+4ubuEh455e4FnaXDR0dLExci/wMOytLiwsbOUl557f4dwcnhmaXAkd/fiAAAANHRSTlMAc1gU/PbxD+LDo3w/Mwrsx0o/Ifr38OdnRkEd/e/r2NDBvLSdkoiGgYBsY11ZVlROPTMfT6pkcAAAAWVJREFUOMvV1GV3gzAUgOEEhrTUZbW5uyYBCtTn8v9/zu7JaJEk2+c+n99zzw0StM6s3hXGWkP/N+wWNii3sY//rjWaYjoVpHYOM8NgNApCHttlVdiskZdXl3Cu50NraPKyVCUZXgSxJi1bJGfow9z8DvU71KwSgQutnT1bn7F+jUgMYQcn89Q7jO24RMaDZ6ajRJGBiEjBCjgprxn3rhpbWJWDTcY9DaXbfk62zo6L9zw9YDEqdOPFN/tV5CkMjccK6ZQtPfD0sV4/mkzC2WxMBGEyNIYpHRGpOS/bg/S3F8hTd8HACVppUBoSuecvxjpWkurwmbqKdtxmFyilQKlHFG4uEUify1eUuyhLN5Vjb1GOQ2kkfbE1lFexYQXJyapNJCgb0ApzWyXVFRBl9p0G21BKWwNi31v+3G8RpSZSKNvQxlfGx5yCQ6RScUyaYpxaSE3Hq+ttT7jexLqhYdztWWit/QAZeJg7kiUxwAAAAABJRU5ErkJggg==",zi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAdVBMVEUAAABpa3ZfY2lgY2pjaW6Ag41gYmlgY2pgY2pgY2qEhJBgYmpfYmpfYmlfYmlgYmlfYmmAhI5gYmlfYmpjZmxgY2qAg42AhIxgYmqAg4yAg41gY2lgYmqAhIxhY2phZWxhZWmAhI1gZWqAipVfYmpfYml/g4yXm/PmAAAAJXRSTlMACsy1F+/ijWVMHevH9tS8lW5tVCqog+DXxsClnJl0Rz86MhipIYttAwAAAQtJREFUOMvlklm2gyAMQCNKFZyH2nl+cf9LfJZ4VGjoBnr/gtcMEPgJojYOs0KUVfJVa0Oc+WLeClxR+bTgjBalrzmBNsLjbdCh4OtO+fJs/iHjvK6cBggAVIqG8DNbs8f1N0VB7Hpq6U7RCR20jhfjwpOOqN/I9k6I7mMEOdPiFdekJkvFVL6jTZo8VcjdojBfc/zkZovJtuloHoczsGxdTwTAE9reJvKuWGbl83jaMUu+7mM3yHo0l+odn04OI/Vqoj2wHIc30rw63WfDevVA6HeQmonZDl+SvJ2JplXjuJAnH2bNaV05NHlHbaJm9E7A0pt0NRB/iFfgOYze5TVviLiDh/7Qa/gh/gEa8zxAg7FEpgAAAABJRU5ErkJggg==",Ii="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAY1BMVEUAAADU1NRjZmxvcnePkZVgY2rPz9BfY2poaHTAwMOAhIxoa3FgYmpgYmlgY2nFxcbU1NRmZm+Ag427u73U1NRfYml/g4zt7e3k5eXW1te9vsCztLefoaWanKCOkJVydXtucXecDQKGAAAAFXRSTlMAzP336NDOiAvTz/rn2tjSph7Qs6d9epWLAAAAjElEQVQ4y+2T2Q6EIAxFK+A6mzMj4q7//5VaYngCG2N8cDkvNOlJSG9TuCq+XMQ3oiQ4p0jGsx+/fCIByDwrqRFzDYDn4BatYiw4Y1zEhBgIJjUsjJbED5eG19ctBtrr66rD9x05RYH9oVBKtViFTvGB7UZNlFg9N4n01/QwdDwrA0/mU0jtK/zDYRgBwgsrsPomQg4AAAAASUVORK5CYII=",Ri="_header_shpzm_1",Mi="_dashboardIcon_shpzm_9",$i="_dashboardIcon2_shpzm_15",Ti="_logo_shpzm_21",Li="_splitLine_shpzm_29",Oi="_title_shpzm_34",Pi="_titleIcon_shpzm_38",Wi="_headBtn_shpzm_44",ji="_compiling_shpzm_53",Hi="_breath_shpzm_1",qi="_helpIcon_shpzm_68",Yi="_configIcon_shpzm_75",Ui="_avatar_shpzm_82",V={header:Ri,dashboardIcon:Mi,dashboardIcon2:$i,logo:Ti,splitLine:Li,title:Oi,titleIcon:Pi,headBtn:Wi,compiling:ji,breath:Hi,helpIcon:qi,configIcon:Yi,avatar:Ui},Vi=[{keys:["alt/^","h"],desc:"\u6253\u5F00\u5FEB\u6377\u952E\u63D0\u793A"},{keys:["alt/^","n"],desc:"\u65B0\u5EFAAPi/\u65B0\u5EFA\u6A21\u578B"},{keys:["alt/^","b"],desc:"\u6279\u91CF\u65B0\u5EFAAPI"},{keys:["alt/^","c"],desc:"\u7F16\u8BD1"},{keys:["alt/^","m"],desc:"\u5207\u6362API\u8BBE\u8BA1\u548C\u6A21\u578B\u8BBE\u8BA1"},{keys:["alt/^","r"],desc:"\u8FD0\u884C\u5F53\u524DOperation"},{keys:["alt/^","t"],desc:"\u6A21\u578B\u8BBE\u8BA1\u9875\u5207\u6362\u8BBE\u8BA1/\u6570\u636E\u89C6\u56FE"},{keys:["alt/^","shift","d"],desc:"\u521B\u5EFA\u5F53\u524DAPI\u7684\u62F7\u8D1D"},{keys:["alt/^","shift","c"],desc:"\u590D\u5236\u5F53\u524DAPI\u8BF7\u6C42\u94FE\u63A5"},{keys:["alt/^","shift","t"],desc:"API\u7F16\u8F91\u9875\u5207\u6362Json/\u8868\u5355\u6A21\u5F0F\uFF0C\u6A21\u578B\u8BBE\u8BA1\u9875\u5207\u6362\u8BBE\u8BA1/\u4EE3\u7801\u6A21\u5F0F"}];function Ki(i){const a=le(),{pathname:e}=pe(),{isFullscreen:s}=d.exports.useContext(ce),[n,o]=d.exports.useState(!1),r=i.engineStatus===X.Compiling||i.engineStatus===X.Starting,u=()=>{r||R.get("/wdg/reStart").then(()=>void L.success("\u5F00\u59CB\u7F16\u8BD1..."))};d.exports.useCallback(()=>{},[]);const l=d.exports.useCallback(()=>{Ae.info({width:"800px",icon:null,title:"\u9875\u9762\u5FEB\u6377\u952E",content:t("div",{className:"flex flex-wrap",children:Vi.map(c=>f("div",{className:"flex pt-1 pr-4 pb-3 pl-1 w-1/2 items-start",children:[t("div",{className:"flex-shrink-0 w-40",children:c.keys.map(p=>t("kbd",{className:"rounded bg-true-gray-200 text-sm mr-1.5 py-1 px-1.5",children:p},p))}),t("span",{children:c.desc})]},c.desc))})})},[]);return d.exports.useEffect(()=>{const c=oe("alt+c,^+c",()=>{u()}),p=oe("alt+h,^+h",()=>{l()});return()=>{c(),p()}},[]),t(K,{children:f("div",{className:V.header,children:[t("div",{className:s?V.dashboardIcon2:V.dashboardIcon,onClick:()=>i.onToggleSider()}),t("div",{className:V.logo,onClick:()=>a("/workbench")}),t("div",{className:V.splitLine}),t("div",{className:V.title,children:"\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF"}),t("div",{className:V.titleIcon}),t("div",{className:"flex-1"}),e==="/workbench/rapi"?f(K,{children:[t("img",{src:"/assets/share.svg",alt:""}),t(Ht,{color:"#2A2B2CFF",content:f("div",{children:[t("a",{className:"text-[#f0f8ff]",onClick:()=>o(!1),href:"/api/v1/file/postToSwag",download:"Swagger.json",children:"\u4E0B\u8F7D swagger"}),t("br",{}),t("a",{className:"text-[#f0f8ff]",onClick:()=>o(!1),href:"/api/v1/file/postToSwag",download:"OpenAPI",children:"\u4E0B\u8F7D OpenAPI"}),t("br",{}),t("a",{className:"text-[#f0f8ff]",onClick:()=>o(!1),href:"/api/v1/operateApi/sdk",download:"SDK",children:"\u4E0B\u8F7D React SDK"})]}),title:!1,trigger:"click",open:n,onOpenChange:c=>o(c),children:f("div",{className:"cursor-pointer",children:[t("img",{src:"/assets/download.svg",alt:"",className:"ml-7"}),t("img",{src:"/assets/shape-down.svg",alt:""})]})})]}):f(K,{children:[t("div",{className:V.headBtn,onClick:u,children:r?t("img",{src:"/assets/compile.gif",className:V.compiling,alt:"\u7F16\u8BD1"}):t("img",{src:Di,className:"h-5 w-5.25",alt:"\u7F16\u8BD1"})}),t("div",{className:V.headBtn,onClick:()=>window.open("/#/workbench/rapi","_blank"),children:t("img",{src:Ii,className:"h-5 w-5",alt:"\u9884\u89C8"})}),t("div",{className:V.headBtn,children:t("img",{src:zi,className:"h-5 w-5",alt:"\u90E8\u7F72"})})]}),t("div",{className:V.splitLine,style:{margin:"0 26px"}}),t("div",{className:"cursor-pointer flex-0 h-4 text-0px w-4",onClick:()=>window.open("https://github.com/fireboomio","_blank"),children:t("img",{className:"h-4 w-4",src:"/assets/github.svg",alt:""})}),t("div",{className:V.helpIcon,onClick:()=>window.open("https://doc.fireboom.io/","_blank")}),t(ne,{title:"\u5FEB\u6377\u952E",children:t("svg",{className:"cursor-pointer ml-4",onClick:l,width:"1.25em",height:"1.25em",viewBox:"0 0 24 24",children:t("path",{fill:"currentColor",d:"M20 3H4c-1.1 0-1.99.9-1.99 2L2 15c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H4V5h16v10zm-9-9h2v2h-2zm0 3h2v2h-2zM8 6h2v2H8zm0 3h2v2H8zM5 9h2v2H5zm0-3h2v2H5zm3 6h8v2H8zm6-3h2v2h-2zm0-3h2v2h-2zm3 3h2v2h-2zm0-3h2v2h-2zm-5 17l4-4H8z"})})}),t("div",{className:V.configIcon,onClick:()=>a("/workbench/setting")}),t("div",{className:V.avatar,children:t("img",{className:"h-5 w-5",alt:"avatar",src:"/assets/total-user.png"})})]})})}const Gi="/assets/refresh.7936fd77.svg",Ji=({sourceOptions:i,onChangeSource:a})=>{const{mutate:e}=ot(),{id:s}=Lt(),n=le(),{id:o}=st(),r=()=>{n(Ot)};return d.exports.useEffect(()=>{i.length>0&&!o&&n(`/workbench/modeling/${i[0].id}`)},[i,o]),f("div",{className:"common-form "+q["select-contain"],children:[t(Re,{className:q.select,onChange:u=>{n(`/workbench/modeling/${u}`)},optionLabelProp:"label",value:o?Number(o):"",options:i.map(u=>{let l="/assets/icon/db-other.svg";switch(u.sourceType){case 1:l={mysql:"/assets/icon/mysql.svg",pgsql:"/assets/icon/pg.svg",graphql:"/assets/icon/graphql.svg",mongodb:"/assets/icon/mongodb.svg",rest:"/assets/icon/rest.svg",sqlite:"/assets/icon/sqlite.svg"}[String(u.config.dbType).toLowerCase()]||l;break;case 2:l="/assets/icon/rest.svg";break;case 3:l="/assets/icon/graphql.svg";break}return{label:f("div",{className:"flex items-center",children:[t("img",{className:"mr-1 w-3 h-3",alt:u.name,src:l}),u.name]}),value:u.id}}),dropdownRender:u=>f("div",{className:"divide-y",children:[u,t("div",{className:"text-center",children:t(_t,{className:"w-full",icon:t(Kt,{}),type:"link",onClick:r,children:"\u7BA1\u7406"})})]})}),t("div",{className:q.refreshBtn,onClick:()=>{e(rt),a(s)},children:t("img",{alt:"\u5237\u65B0",src:Gi,className:"w-4 h-4"})})]})},Zi="/assets/del.967f6233.svg",Xi="/assets/entity.f4366b1c.svg",Qi="/assets/entity-active.695b4f14.svg",es="/assets/enum.4b47b629.svg",ts="/assets/enum-active.50867240.svg",is="/assets/more.7449b878.svg",ss="/assets/rename.b624bb15.svg",ns=({entity:i,onClick:a,onToggleDesigner:e,setShowType:s,editFlag:n,newFlag:o})=>{const{currentEntityId:r,changeToEntityById:u}=Me(),{blocks:l,updateAndSaveBlock:c,applyLocalBlocks:p}=lt(),[g,E]=se(!1),[_,b]=se(i.name===""),[k,S]=se(!1),{getFirstEntity:M}=ct(),{panel:$,triggerSyncEditor:B}=d.exports.useContext(fe),{inEdit:x}=$||{},m=r===i.id,D=N=>{N.domEvent.stopPropagation(),(N.key==="1"||N.key==="2")&&S(!1)},w=N=>{N.key==="Escape"&&b(!1)},v=()=>{var N,T,Y;if(S(!1),x){const J=me(l).deleteEntity(i.id);p(J),B(),u(J.filter(Q=>Q.type==="model"||Q.type==="enum")[0].id)}else{m&&(u((T=(N=M())==null?void 0:N.id)!=null?T:0),s(((Y=M())==null?void 0:Y.type)==="model"?"preview":"editEnum"));const J=L.loading("\u5220\u9664\u4E2D...",0);c(me(l).deleteEntity(i.id)).then(()=>{L.success("\u5220\u9664\u6210\u529F")}).finally(()=>{J()})}},I=N=>{if(b(!1),!N){L.error("\u5B9E\u4F53\u540D\u4E0D\u53EF\u4E3A\u7A7A\uFF01");return}const T=new RegExp(Pt).test(N);if(N===Wt||!T){L.error("\u5B9E\u4F53\u540D\u4E0D\u5408\u6CD5\uFF01");return}if(x){b(!1);const Y=me(l).updateEntityName(i.id,N);p(Y),B()}else{const Y=L.loading("\u4FDD\u5B58\u4E2D...",0);c(me(l).updateEntityName(i.id,N)).then(()=>{L.success("\u5B9E\u4F53\u540D\u66F4\u65B0\u6210\u529F")}).catch(J=>L.error(`\u5B9E\u4F53\u540D\u66F4\u65B0\u5931\u8D25, error: ${J.message}`)).finally(()=>{Y()})}},W=N=>{N||(E(!1),S(!1))},j=()=>t(xe,{onClick:D,items:[{key:1,label:t("span",{children:"\u91CD\u547D\u540D"}),icon:t("img",{src:ss,alt:"\u91CD\u547D\u540D"}),onClick:()=>b(!_)},{key:4,label:t($e,{className:"w-full h-full",placement:"right",title:"\u786E\u8BA4\u5220\u9664\u8BE5\u5B9E\u4F53\u5417\uFF1F\u5C06\u4F1A\u540C\u65F6\u5220\u9664\u5F15\u7528\u5B57\u6BB5\uFF01",onConfirm:v,okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",onCancel:()=>S(!1),overlayClassName:q["delete-label"],okType:"danger",children:t("span",{children:"\u5220\u9664"})}),icon:t("img",{src:Zi,alt:"\u5220\u9664"})}]}),C=_?t(de,{onBlur:N=>I(N.target.value),onKeyUp:w,onPressEnter:N=>I(N.currentTarget.value),className:"text-sm font-normal leading-4 h-5 w-5/7 pl-1",defaultValue:i.name,autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165\u5B9E\u4F53\u540D"}):t("div",{className:"text-sm font-normal leading-4 "+q.name,children:i.name});return f("div",{className:`${q.item} ${m?q.itemActive:""}`,onMouseEnter:()=>E(!0),onMouseLeave:()=>W(k),onClick:a,onDoubleClick:()=>b(!0),children:[t("div",{className:q.icon,children:i.type==="model"?t("img",{src:m?Qi:Xi,alt:"\u6A21\u578B"}):t("img",{src:m?ts:es,alt:"\u679A\u4E3E"})}),C,n?t("div",{className:q.editMark}):null,o?t("div",{className:q.addMark}):null,t(_e,{overlay:j,trigger:["click"],placement:"bottomRight",open:k,onOpenChange:N=>{S(N),W(N)},children:t("div",{className:q.dropdownIcon,onClick:N=>N.stopPropagation(),style:{visibility:g?"visible":"hidden"},children:t("img",{src:is,alt:"\u83DC\u5355"})})})]},i.id)},as="/assets/er.158e0757.svg",os="/assets/modeling-switch.afd2342d.svg",rs=({changeToER:i,addNewModel:a})=>{const{panel:e}=d.exports.useContext(fe),{handleSetInEdit:s,inEdit:n}=e||{},{currentEntity:o}=Me();let r=n?"\u6570\u636E\u5EFA\u6A21":"\u6570\u636E\u9884\u89C8";return o||(r="\u6570\u636E\u5EFA\u6A21"),d.exports.useEffect(()=>oe("alt+t,^+t",()=>{s(!n)}),[s,n]),f("div",{className:q.actions,children:[t("span",{className:"mr-auto font-500 text-[#333] text-14px",children:r}),t("div",{onClick:()=>s(!n),className:q.switchBtn,children:t("img",{src:os,alt:"switch"})}),t("div",{onClick:i,className:q.erBtn,children:t("img",{src:as,alt:"ER"})}),t("div",{onClick:a,className:q.addEntityBtn,children:"+"})]})},ls=({sourceOptions:i,onChangeSource:a,onClickEntity:e,onToggleDesigner:s,changeToER:n,addNewModel:o,setShowType:r})=>{const{entities:u,editMap:l,newMap:c,delMap:p}=ct();Me();const{panel:g,triggerSyncEditor:E,dispatch:_}=d.exports.useContext(fe),{handleClickEntity:b}=g,{handleSetInEdit:k,inEdit:S}=g||{},{blocks:M,applyLocalSchema:$,applyLocalBlocks:B}=lt(),x=async()=>{const D=`
model ${`${qe}${Math.max(0,...u.map(I=>{const W=I.name.match(new RegExp(`${qe}(\\d*)`));return W?Number(W[1]):0}))+1}`} {
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime
  deletedAt DateTime?
}
`;let w=qt({type:"schema",list:M});w+=D;const v=jt(w);B(v),E(),setTimeout(()=>{b(v[v.length-1]),k(!0)},100)};return d.exports.useEffect(()=>oe("alt+n,^+n",()=>{x()}),[]),f("div",{className:"flex flex-col flex-1 min-h-0",children:[f("div",{className:q.pannel,children:[t(Ji,{sourceOptions:i,onChangeSource:a}),t(rs,{addNewModel:x,changeToER:n})]}),t("div",{className:"flex-1 mt-1 overflow-y-auto",children:u.map(m=>t(ns,{editFlag:l[m.name],newFlag:c[m.name],setShowType:r,entity:m,onClick:()=>e(m),onToggleDesigner:s},m.id))}),Object.keys(p).length?t("div",{className:"bg-[#f7f7f7] rounded-4px m-2 px-3 text-[#666] leading-32px",children:"\u7CFB\u7EDF\u68C0\u6D4B\u5230\u60A8\u53EF\u80FD\u5220\u9664\u6216\u91CD\u547D\u540D\u4E86\u6A21\u578B\uFF0C\u8FC1\u79FB\u540E\u5C06\u5BFC\u81F4\u6570\u636E\u4E22\u5931\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C"}):null]})},cs=ls;var us=Bt;function hs(i){return i&&i.length?us(i):[]}var ds=hs;const ps=ds,fs="_container_rq4mp_1",ms="_active_rq4mp_9",gs="_header_rq4mp_15",vs="_arrow_rq4mp_25",bs="_headerOpen_rq4mp_32",ws="_title_rq4mp_35",ys="_add_rq4mp_46",Es="_action_rq4mp_52",ks="_content_rq4mp_59",ee={container:fs,active:ms,header:gs,arrow:vs,headerOpen:bs,title:ws,add:ys,action:Es,content:ks};function ht(i){const[a,e]=d.exports.useState(!1);d.exports.useEffect(()=>{i.open!==void 0?s(i.open):i.defaultOpen&&s(!0)},[i.defaultOpen,i.open]);const s=n=>{e(n),i.onOpen&&i.onOpen(n)};return f("div",{className:`${ee.container} ${a?ee.active:""}`,children:[f("div",{className:`${ee.header} ${a?ee.headerOpen:""}`,onClick:n=>s(!a),children:[t("div",{className:ee.arrow}),t("div",{className:ee.title,children:i.title}),f("div",{className:ee.action,onClick:n=>n.stopPropagation(),children:[i.action?i.action:null,i.hideAdd?null:t(ne,{title:"\u65B0\u5EFA",children:t("div",{className:ee.add,onClick:i.onAdd})})]})]}),t("div",{className:`${a?"":"hidden"} ${ee.content}`,children:i.children})]})}const As="_headerFilter_8o5jf_1",_s="_headerConfig_8o5jf_2",xs="_headerRefresh_8o5jf_3",Fs="_headerNewFold_8o5jf_4",Cs="_headerNewFile_8o5jf_5",Ns="_createRowWrapper_8o5jf_25",Bs="_createRow_8o5jf_25",Ss="_btn_8o5jf_44",Ds="_graphqlEntry_8o5jf_48",zs="_treeContainer_8o5jf_59",Is="_treeItem_8o5jf_117",Rs="_title_8o5jf_117",Ms="_treeItemDir_8o5jf_126",$s="_icon_8o5jf_126",Ts="_treeItemFile_8o5jf_130",Ls="_treeItemErr_8o5jf_134",Os="_lighting_8o5jf_138",Ps="_treeItemDisable_8o5jf_144",Ws="_suffix_8o5jf_177",js="_errLabel_8o5jf_182",Hs="_more_8o5jf_195",O={headerFilter:As,headerConfig:_s,headerRefresh:xs,headerNewFold:Fs,headerNewFile:Cs,createRowWrapper:Ns,createRow:Bs,btn:Ss,graphqlEntry:Ds,treeContainer:zs,treeItem:Is,title:Rs,treeItemDir:Ms,icon:$s,treeItemFile:Ts,treeItemErr:Ls,lighting:Os,treeItemDisable:Ps,suffix:Ws,errLabel:js,more:Hs};function qs(i){const{config:a}=it(),e=le(),s=pe(),[n,o]=d.exports.useState(null),[r,u]=d.exports.useState([]),[l,c]=d.exports.useState([]),[p,g]=d.exports.useState(null),[E,_]=d.exports.useState(""),[b,k]=d.exports.useState(),[S,M]=d.exports.useState(!1),[$,B]=d.exports.useState(!1),[x,m]=d.exports.useState(!1),[D,w]=d.exports.useState(),[v,I]=d.exports.useState([]),[W,j]=d.exports.useState(),C=d.exports.useMemo(()=>p?et(p,r):null,[p,r]),N=d.exports.useMemo(()=>{var A;const h={},y=[...r];for(;y.length;){const F=y.pop();!F||((A=F.children)!=null&&A.length&&y.push(...F.children),h[F.key]=F)}return h},[r]),T=d.exports.useMemo(()=>l.map(h=>N[h]).filter(h=>h),[l,N]),{refreshMap:Y,navCheck:J,triggerPageEvent:Q}=d.exports.useContext(ce),Fe=d.exports.useRef();d.exports.useEffect(()=>{const h=oe("alt+n,^+n",()=>{ue("\u521B\u5EFA\u6587\u4EF6")}),y=oe("alt+b,^+b",()=>{e("/workbench/apimanage/crud")});return()=>{h(),y()}},[]),d.exports.useEffect(()=>{var h,y;if(!s.pathname.match(/^\/workbench\/apimanage(?:\/\d*)?$/))Fe.current=!1,c([]);else{if(!Fe.current&&r){const A=Number((y=((h=s.pathname.match(/\/apimanage\/(\d+)/))!=null?h:[])[1])!=null?y:0);if(A){const F=Qe(A,r);F&&c([F.key])}}Fe.current=!0}},[s]),d.exports.useEffect(()=>{i.defaultOpen&&m(!0)},[i.defaultOpen]),d.exports.useEffect(()=>{D&&(ue(D),w(void 0))},[r]),d.exports.useEffect(()=>{!x||je("/operateApi").then(h=>{var F,U;const y=Ie(h,"0");u(y);const A=Number((U=((F=s.pathname.match(/\/apimanage\/(\d+)/))!=null?F:[])[1])!=null?U:0);if(A){const z=Qe(A,y);bt(y,A),z&&c([z.key])}}).catch(h=>{throw h})},[x,b,Y.api]),d.exports.useEffect(()=>{if(C){const h=Ys(r);if(!h)return;g(h.key)}},[r]),d.exports.useEffect(()=>{!S&&$&&(o(null),g(null),k(!b)),B(!1)},[S,$]);const dt=d.exports.useCallback((h,y)=>{(async()=>{let{node:A}=y;if(y.nativeEvent.shiftKey){let F;if(l.includes(A.key)?(F=l.filter(U=>U!==A.key),c(F)):(F=[...l,A.key],c(F)),F.length!==1)return;{const U=et(F[0],r);if(!U)return;A=U}}!await J()||(c([]),A.isDir?e("/workbench/apimanage",{replace:!0}):e(`/workbench/apimanage/${A.id}`,{replace:!0}),A.key!==l[0]?c([A.key]):c([]))})()},[J,l]);function pt(h){return h.legal?t("div",{className:O.errLabel,children:"\u975E\u6CD5"}):h.isPublic?h.method:"\u5185\u90E8"}const ft=d.exports.useCallback(h=>_(h.target.value),[]),mt=d.exports.useCallback(h=>{h.stopPropagation()},[]),ue=h=>{var ae,Pe;if(l.length>1){L.error("\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\u8282\u70B9");return}if(!x){w(h),m(!0);return}o(h);const{parent:y,curr:A}=Ks(l[0],r),F={title:"",baseDir:(ae=A==null?void 0:A.currDir)!=null?ae:"",isDir:h==="\u521B\u5EFA\u76EE\u5F55",key:Date.now().toString()};(A==null?void 0:A.children)===null&&(A.children=[]);const U=r!=null?r:[];let z;A!=null&&A.isDir?z=A:y&&(z=y),z?((Pe=z.children)==null||Pe.push(F),v.includes(z.key)||I([...v,z.key])):U.push(F),_(""),g(F.key),u([...U])},Te=(h,y=!1)=>Be(h[0])?h.match(/^\w[a-zA-Z0-9_]*$/)?!0:(L.error("\u8BF7\u8F93\u5165\u5B57\u6BCD\u3001\u6570\u5B57\u6216\u4E0B\u5212\u7EBF"),!1):(L.error("\u63A5\u53E3\u540D\u79F0\u5FC5\u987B\u5927\u5199\u5F00\u5934"),!1),Ce=h=>h?h.filter(y=>(y.children&&(y.children=Ce(y.children)),y.id!==void 0)):(u(r.filter(y=>(y.children&&(y.children=Ce(y.children)),y.id!==void 0))),r),Le=()=>{if(!C){o(null);return}if(!!Te(E,C.isDir))switch(n){case"\u91CD\u547D\u540D":if(C.isDir)Us(C,E).then(h=>{g(null),k(!b)});else{if(!Be(E[0])){L.error("\u63A5\u53E3\u540D\u79F0\u5FC5\u987B\u5927\u5199\u5F00\u5934");return}Vs(C,E).then(h=>{g(null),h&&ze.emit({event:"titleChange",data:{title:E,path:`${C.baseDir}/${E}`}}),k(!b)})}break;case"\u521B\u5EFA\u76EE\u5F55":Js(C,E).then(()=>{g(null),k(!b)});break;case"\u521B\u5EFA\u6587\u4EF6":at(E)?(g(null),k(!b)):Be(E.at(0))?(gt(),C.title=E):L.warn("\u63A5\u53E3\u540D\u79F0\u5FC5\u987B\u5927\u5199\u5F00\u5934\uFF01");break}},gt=()=>{if(n==="\u521B\u5EFA\u6587\u4EF6"){if(!C)return;Zs(C,E).then(h=>{h!=null&&h.id&&(e(`/workbench/apimanage/${h==null?void 0:h.id}`),g(null),k(!b))}).catch(h=>{o("\u521B\u5EFA\u6587\u4EF6")})}o(null)},vt=h=>{o(null),Gs(h).then(()=>{var y;if(g(null),k(!b),localStorage.removeItem(`_api_args_${h.id}`),`/workbench/apimanage/${h.id}`===s.pathname){const A=[...r];for(;;){const F=A.shift();if(!F){e("/workbench/apimanage");return}if((y=F.children)!=null&&y.length){A.push(...F.children);continue}if(!F.isDir&&F.id!==h.id){e(`/workbench/apimanage/${F.id}`);return}}}})},bt=(h,y)=>{const A=[];let F;for(let z=0;z<h.length;z++){const ae=h[z];if(F=U(ae),F)break}function U(z){if(!z.isDir&&(!y||y===z.id))return z;if(z.children){const ae=z.children.find(U);if(ae)return A.push(z.key),ae}}return F?(I(ps([...v,...A])),F):!1};async function Oe(h){await R.post("operateApi/batchOnline",{Ids:T.map(y=>y.id),enable:h}),L.success("\u64CD\u4F5C\u6210\u529F"),k(!b)}const wt=h=>{const y=pt(h);let A;h.isDir?A=O.treeItemDir:h.legal?A=O.treeItemErr:h.enable?A=O.treeItemFile:A=O.treeItemDisable;let F=[{key:"rename",label:f("div",{onClick:()=>{g(h.key),_(h.title),o("\u91CD\u547D\u540D")},children:[t(he,{type:"icon-zhongmingming"}),t("span",{className:"ml-1.5",children:"\u91CD\u547D\u540D"})]})},{key:"delete",label:t("div",{onClick:z=>z.stopPropagation(),children:f($e,{title:"\u786E\u5B9A\u5220\u9664\u5417?",onConfirm:()=>{vt(h),j(void 0)},onCancel:()=>{j(void 0)},okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",placement:"right",children:[t(he,{type:"icon-shanchu"}),t("span",{className:"ml-1.5",children:"\u5220\u9664"})]})})}];h.isDir&&(F=F.filter(z=>z.key!=="edit"));const U=t(xe,{onClick:z=>{z.key!=="delete"&&j(void 0)},items:F});return f("div",{className:`${O.treeItem} ${A}`,children:[t("div",{className:O.icon,children:h.liveQuery?t("div",{className:O.lighting}):null}),p&&h.key===p?t(de,{size:"small",defaultValue:h.title,onPressEnter:Le,onBlur:()=>{E&&Te(E,C==null?void 0:C.isDir)?Le():(g(null),Ce())},onChange:ft,autoFocus:!0,onClick:mt}):f(K,{children:[t("div",{className:O.title,children:h.title}),t("div",{className:O.suffix,children:y}),t("div",{onClick:z=>z.stopPropagation(),children:t(_e,{open:W===h.key,onOpenChange:z=>{j(z?h.key:void 0)},destroyPopupOnHide:!0,overlay:U,trigger:["click"],placement:"bottomRight",children:t("div",{className:O.more,onClick:z=>z.preventDefault()})})})]})]})};return f(ht,{...i,title:"API\u7BA1\u7406",hideAdd:!0,open:x,onOpen:h=>{m(h),i.onOpen&&i.onOpen(h)},action:f(K,{children:[t(ne,{title:"\u5237\u65B0\u5217\u8868",children:t("div",{className:O.headerRefresh,onClick:()=>{je("/operateApi").then(h=>u(Ie(h))).then(()=>L.success("\u5237\u65B0\u5B8C\u6210\uFF01")).catch(h=>{throw L.error("\u83B7\u53D6\u6587\u4EF6\u5217\u8868\u5931\u8D25\uFF01"),h})}})}),t(ne,{title:"\u5168\u5C40\u8BBE\u7F6E",children:t("div",{className:O.headerConfig,onClick:()=>M(!0)})}),t(ne,{title:"\u65B0\u5EFA\u76EE\u5F55",children:t("div",{className:O.headerNewFold,onClick:()=>ue("\u521B\u5EFA\u76EE\u5F55")})}),t(ne,{title:"\u65B0\u5EFAAPI",children:t("div",{className:O.headerNewFile,onClick:()=>ue("\u521B\u5EFA\u6587\u4EF6")})})]}),children:[t(_e,{overlay:t(xe,{items:[{disabled:!T.some(h=>!h.enable),key:"enable",label:t("div",{onClick:()=>{!T.some(h=>!h.enable)||Oe(!0)},children:"\u4E0A\u7EBF"})},{disabled:!T.some(h=>h.enable),key:"disable",label:t("div",{onClick:()=>{!T.some(h=>h.enable)||Oe(!1)},children:"\u4E0B\u7EBF"})},{disabled:!T.length,key:"delete",label:t("div",{onClick:()=>{c([]),Ae.confirm({title:"\u662F\u5426\u786E\u8BA4\u5220\u9664\u9009\u4E2D\u7684API\uFF1F",onOk:()=>{const h=T.map(y=>y.id).filter(y=>y);R.post("operateApi/batchDelete",{ids:h}).then(()=>{h.forEach(y=>localStorage.removeItem(`_api_args_${y}`)),L.success("\u5220\u9664\u6210\u529F"),k(!b)})},okText:"\u786E\u8BA4",cancelText:"\u53D6\u6D88"})},children:"\u5220\u9664"})},{key:"cancel",label:t("div",{onClick:()=>{c([])},children:"\u53D6\u6D88"})}]}),trigger:["contextMenu"],children:f("div",{className:"flex flex-col h-full justify-between",children:[t("div",{className:O.treeContainer,children:r.length?t(xt,{rootClassName:"overflow-auto",titleRender:wt,showIcon:!0,defaultExpandParent:!0,expandedKeys:v,onExpand:I,treeData:r,multiple:!0,selectedKeys:l,onSelect:dt}):null}),f("div",{className:O.createRowWrapper,children:[f("div",{className:O.createRow,children:[t("span",{className:O.btn,onClick:()=>ue("\u521B\u5EFA\u6587\u4EF6"),children:"\u65B0\u5EFA"}),t("span",{children:" \u6216\u8005 "}),t("span",{className:O.btn,onClick:()=>e("/workbench/apimanage/crud"),children:"\u6279\u91CF\u65B0\u5EFA"})]}),t(ne,{title:"\u6D4B\u8BD5",children:t("div",{className:O.graphqlEntry,onClick:()=>{const h=new URL(window.location.href);a.apiHost?window.open(`${h.protocol}//localhost:${h.port}/app/main/graphql`,"_blank"):window.open(`${h.protocol}//${h.hostname}:${a.apiPort}/app/main/graphql`,"_blank")},children:t("img",{alt:"",src:"/assets/icon/graphql2.svg"})})})]})]})}),t(Ae,{title:"API\u5168\u5C40\u8BBE\u7F6E",open:S,onOk:()=>{M(!1)},onCancel:()=>{M(!1)},footer:null,centered:!0,children:t(Dt,{type:"global",onClose:()=>M(!1)})})]})}function Ie(i,a="0"){return i?i.map((e,s)=>({...e,key:`${a}-${s}`,title:e.path.split("/")[e.path.split("/").length-1],baseDir:e.path.split("/").slice(0,-1).join("/"),currDir:e.isDir?e.path:e.path.split("/").slice(0,-1).join("/"),children:Ie(e.children,`${a}-${s}`)})):[]}function Ys(i){let a;const e=s=>{!s||s.find(n=>{var o;return n.title===""?(a=n,n):e((o=n.children)!=null?o:void 0)})};return e(i),a}function Qe(i,a){let e;const s=(n,o)=>{!o||o.find(r=>{var u;return r.id===i?(e=r,r):s(n,(u=r.children)!=null?u:void 0)})};return s(i,a),e}function et(i,a){let e;const s=(n,o)=>{!o||o.find(r=>{var u;return r.key===n?(e=r,r):s(n,(u=r.children)!=null?u:void 0)})};return s(i,a),e}function Us(i,a){return R.put("/operateApi/dir",{oldPath:`${i.path}`,newPath:`${i.baseDir}/${a}`})}function Vs(i,a){return R.put(`/operateApi/rename/${i.id}`,{path:`${i.baseDir}/${a}`}).catch(e=>{console.error(e)})}function Ks(i,a){let e,s;const n=(o,r)=>{if(!r)return[];e=void 0,r.find(u=>{var l;return u.key===o?(s=u,[e,s]):(at(u.children)||(e=u),n(o,(l=u.children)!=null?l:void 0))})};return n(i,a),e=s?e:void 0,{parent:e,curr:s}}function Gs(i){return i.isDir?R.delete("/operateApi/dir",{data:{path:i.path}}):R.delete(`/operateApi/${i.id}`)}function Js(i,a){return R.post("/operateApi/dir",{path:`${i.baseDir}/${a}`})}function Zs(i,a){return R.post("/operateApi",{path:`${i.baseDir}/${a}`})}function Xs(i,a){switch(a.type){case"fetched":return a.data;case"selected":return i;case"added":return[...i,a.data];case"changed":return i.map(e=>e.id===a.data.id?a.data:e);case"deleted":return i.filter(e=>e.id!==a.data.id);default:return i}}const Qs="_container_18kpt_1",en="_row_18kpt_4",tn="_active_18kpt_16",sn="_rowDisable_18kpt_30",nn="_icon_18kpt_30",an="_title_18kpt_33",on="_tip_18kpt_52",rn="_more_18kpt_59",te={container:Qs,row:en,active:tn,rowDisable:sn,icon:nn,title:an,tip:on,more:rn},ln={dataSource:{title:"\u6570\u636E\u6E90",openItem:i=>`/workbench/dataSource/${i}`,newItem:"/workbench/dataSource/new",request:{getList:i=>{R.get("/dataSource").then(a=>{i({type:"fetched",data:a.map(e=>{let s="other",n="/assets/icon/db-other.svg",o="";switch(e.sourceType){case 1:o=String(e.config.dbName||""),n={mysql:"/assets/icon/mysql.svg",pgsql:"/assets/icon/pg.svg",graphql:"/assets/icon/graphql.svg",mongodb:"/assets/icon/mongodb.svg",rest:"/assets/icon/rest.svg",sqlite:"/assets/icon/sqlite.svg"}[String(e.config.dbType).toLowerCase()]||n;break;case 2:n="/assets/icon/rest.svg";break;case 3:n="/assets/icon/graphql.svg";break}return{id:e.id,name:e.name,icon:s,tip:o,switch:e.switch,_row:e,svg:n}})})})},editItem:async i=>await R.put("/dataSource",i),delItem:async i=>await R.delete(`/dataSource/${i}`)},mutateKey:i=>["/dataSource",String(i)]},storage:{title:"\u6587\u4EF6\u5B58\u50A8",openItem:i=>`/workbench/storage/${i}/manage`,newItem:"/workbench/storage/new",request:{getList:i=>{R.get("/storageBucket").then(a=>{i({type:"fetched",data:(a!=null?a:[]).map(e=>{const s="other",n="";return{id:e.id,name:e.name,icon:s,tip:n,switch:e.switch,_row:e,svg:"/assets/icon/file.svg"}})})})},editItem:async i=>await R.put("/storageBucket",i),delItem:async i=>await R.delete(`/storageBucket/${i}`)},mutateKey:i=>["/dataSource",String(i)],navMenu:[{icon:"icon-wenjian1",name:"\u67E5\u770B",menuPath:i=>`/workbench/storage/${i}`}]},auth:{title:"\u8EAB\u4EFD\u9A8C\u8BC1",openItem:i=>`/workbench/auth/${i}`,newItem:"/workbench/auth/new",navAction:[{icon:"/assets/workbench/panel-role.png",path:"/workbench/auth/role",tooltip:"\u6743\u9650\u7BA1\u7406"}],mutateKey:i=>["/auth",String(i)],request:{getList:i=>{R.get("/auth").then(a=>{const e=a.map(s=>{const n="other",o="openid";return{id:s.id,name:s.name,icon:n,tip:o,switch:s.switch,_row:s,svg:"/assets/icon/github-fill.svg"}});e.unshift({disableMenu:!0,svg:"/assets/icon/github-fill.svg",switch:1,icon:"other",name:"\u9ED8\u8BA4\u8BA4\u8BC1\u5668",_row:{name:""},id:0,tip:"\u524D\u5F80>",openInNewPage:"#/auth/userManage"}),i({type:"fetched",data:e})})},editItem:async i=>await R.put("/auth",i),delItem:async i=>await R.delete(`/auth/${i}`)}}};function De(i){var x;const{mutate:a}=ot(),e=d.exports.useMemo(()=>ln[i.type],[i.type]),s=le(),n=pe(),[o,r]=d.exports.useState(),[u,l]=d.exports.useState(),[c,p]=d.exports.useReducer(Xs,[]),{refreshMap:g,navCheck:E}=d.exports.useContext(ce),[_,b]=d.exports.useState(!1),k=g[i.type];d.exports.useEffect(()=>{!_||e.request.getList(p)},[i.type,k,_]);const S=m=>{const D=[{key:"rename",label:f("div",{onClick:()=>r(m),children:[t(he,{type:"icon-zhongmingming"}),t("span",{className:"ml-1.5",children:"\u91CD\u547D\u540D"})]})},{key:"delete",label:t($e,{placement:"right",title:"\u786E\u8BA4\u5220\u9664\u8BE5\u5B9E\u4F53\u5417\uFF1F",onConfirm:()=>void M(u),okText:"\u5220\u9664",cancelText:"\u53D6\u6D88",overlayClassName:te["delete-label"],okType:"danger",children:f("div",{children:[t(he,{type:"icon-a-shanchu2"}),t("span",{className:"ml-1.5",children:"\u5220\u9664"})]})})}];return e.navMenu&&D.unshift(...e.navMenu.map(w=>({key:w.name,label:f("div",{onClick:()=>s(w.menuPath(m.id)),children:[t(he,{type:w.icon}),t("span",{className:"ml-1.5",children:w.name})]},m.id)}))),t(xe,{onClick:w=>{w.key!=="delete"&&l(void 0)},items:D})},M=async m=>{if(!!m&&(await e.request.delItem(m),e.request.getList(p),l(void 0),e.openItem(m)===n.pathname)){const D=c.findIndex(w=>!w.openInNewPage);D>=0?B(c[D]):s(e.newItem)}},$=async m=>{const D=o==null?void 0:o._row;if(D!==void 0){if(!m.match(/^\w[a-zA-Z0-9_]*$/)){L.error("\u8BF7\u8F93\u5165\u5B57\u6BCD\u3001\u6570\u5B57\u6216\u4E0B\u5212\u7EBF");return}D.name=m,await e.request.editItem(D),e.request.getList(p),r(void 0),await a(e.mutateKey(String(o==null?void 0:o.id)))}},B=m=>{if(m.openInNewPage){window.open(m.openInNewPage);return}const D=e.openItem(m.id);E().then(w=>{w&&s(D)})};return t(ht,{title:e.title,onAdd:()=>s(e.newItem),onOpen:m=>b(m),defaultOpen:i.defaultOpen,action:t(K,{children:(x=e.navAction)==null?void 0:x.map(m=>f(ne,{title:m.tooltip,children:[t("div",{className:"flex mr-1.5",onClick:()=>s(m.path),children:t("img",{width:19,height:19,src:m.icon,alt:"\u5934\u50CF"})})," "]},m.path))}),children:t("div",{className:te.container,children:c.map(m=>{var w;const D=e.openItem(m.id);return f("div",{className:`${te.row} ${m.switch?"":te.rowDisable} ${D===n.pathname?te.active:""}`,onClick:()=>B(m),children:[t("div",{className:te.icon,children:t(Yt,{width:12,height:12,preview:!1,alt:m.name,src:(w=m.svg)!=null?w:"/assets/icon/github-fill.svg"})}),(o==null?void 0:o.id)===m.id?t(de,{onPressEnter:v=>void $(v.target.value),onBlur:v=>void $(v.target.value),onKeyUp:v=>{v.key=="Escape"&&r(void 0)},className:"font-normal h-5 text-sm leading-4 w-5/7",defaultValue:o.name,autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165\u5916\u90E8\u6570\u636E\u6E90\u540D"}):t("div",{className:te.title,children:m.name}),t("div",{className:te.tip,children:m.tip}),!m.disableMenu&&t("div",{onClick:v=>v.stopPropagation(),children:t(_e,{overlay:S(m),trigger:["click"],open:u===m.id,onOpenChange:v=>{l(v?m.id:void 0),console.log(u)},placement:"bottomRight",children:t("div",{className:te.more,onClick:v=>v.preventDefault()})})})]},m.id)})})})}const cn="_container_xritx_1",un="_tabs_xritx_6",hn="_tabs_inner_xritx_11",dn="_tabs_tab_xritx_19",pn="_tabs_tab__active_xritx_30",fn="_apiIcon_xritx_36",mn="_dataIcon_xritx_42",gn="_panels_xritx_60",ie={container:cn,tabs:un,tabs_inner:hn,tabs_tab:dn,tabs_tab__active:pn,apiIcon:fn,dataIcon:mn,panels:gn},tt={api:"/workbench",data:"/workbench/modeling"};function vn(){const[i,a]=d.exports.useState(""),e=pe(),s=le();d.exports.useContext(ce),d.exports.useEffect(()=>oe("alt+m,^+m",()=>{e.pathname.startsWith("/workbench/modeling")?s("/workbench"):s("/workbench/modeling"),a(i)}),[]),d.exports.useEffect(()=>{const g=e.pathname.startsWith("/workbench/modeling")?"data":"api";a(g)},[e.pathname]);const{panel:n}=d.exports.useContext(fe),{handleToggleDesigner:o,handleClickEntity:r,handleChangeSource:u,setShowType:l,dataSources:c}=n||{},p=g=>{tt[i]=e.pathname,s(tt[g])};return f("div",{className:"flex flex-col h-full",children:[t("div",{className:ie.tabs,children:f("div",{className:ie.tabs_inner,children:[f("div",{className:`${ie.tabs_tab} ${i==="api"?ie.tabs_tab__active:""}`,onClick:()=>{p("api")},children:[t("div",{className:ie.apiIcon}),"API\u8BBE\u8BA1"]}),f("div",{className:`${ie.tabs_tab}  ${i==="data"?ie.tabs_tab__active:""}`,onClick:()=>{p("data")},children:[t("div",{className:ie.dataIcon}),"\u6570\u636E\u5EFA\u6A21"]})]})}),i==="api"?f("div",{className:ie.panels,children:[t(qs,{defaultOpen:e.pathname.startsWith("/workbench/apimanage/")}),t(De,{type:"dataSource",defaultOpen:e.pathname.startsWith("/workbench/dataSource/")}),t(De,{type:"auth",defaultOpen:e.pathname.startsWith("/workbench/auth/")}),t(De,{type:"storage",defaultOpen:e.pathname.startsWith("/workbench/storage/")})]}):null,i==="data"&&n?t(cs,{setShowType:l,changeToER:()=>l("erDiagram"),addNewModel:()=>l("newModel"),addNewEnum:()=>l("newEnum"),sourceOptions:c,onChangeSource:g=>u(g),onClickEntity:r,onToggleDesigner:o}):null]})}const bn="_workbench_19yet_1",wn="_header_19yet_1",yn="_footer_19yet_7",En="_sider_19yet_13",ye={workbench:bn,header:wn,footer:yn,sider:En},{Header:kn,Footer:An,Sider:_n,Content:xn}=Ee;function Fn(i){const[a,e]=d.exports.useState(),[s,n]=d.exports.useState("--"),[o,r]=d.exports.useState("--"),[u,l]=d.exports.useState(!1),[c,p]=d.exports.useState(),[g,E]=d.exports.useState(!1),_=d.exports.useRef(),[b,k]=d.exports.useState(!1),[S,M]=se({api:!1,auth:!1,dataSource:!1,storage:!1});d.exports.useEffect(()=>{R.get("/wdg/barOnce").then(I=>{n(I.version),r(I.env)});const w=new AbortController,v=w.signal;return fetch("/api/v1/wdg/state",{signal:v}).then(I=>{var C;const W=(C=I.body)==null?void 0:C.getReader();if(!W)return;const j=({value:N,done:T})=>{if(!T){try{new Response(N).text().then(J=>{const Q=nt(J).pop();Q&&(e(Q),Q.engineStatus===X.Running?ze.emit({event:"compileFinish"}):(Q.engineStatus===X.CompileFail||Q.engineStatus===X.StartFail)&&ze.emit({event:"compileFail"}))})}catch(Y){console.log(Y)}W.read().then(j)}};W.read().then(j)}),()=>{w.abort()}},[]);const $=w=>{M(v=>{v[w]=!v[w]})},B=w=>{k(w)},x=d.exports.useCallback(async()=>b?await new Promise(w=>{Ae.confirm({title:"\u5373\u5C06\u79BB\u5F00\u5F53\u524D\u9875\u9762\uFF0C\u4E3A\u4FDD\u5B58\u7684\u5185\u5BB9\u5C06\u88AB\u90FD\u662F\uFF0C\u662F\u5426\u786E\u8BA4\uFF1F",onOk:()=>{k(!1),w(!0)},onCancel:()=>w(!1)})}):!0,[b]),m=f(Ee,{className:`h-100vh ${ye.workbench}`,children:[t(kn,{className:ye.header,children:t(Ki,{onToggleSider:()=>E(!g),engineStatus:a==null?void 0:a.engineStatus})}),f(Ee,{children:[t(_n,{width:230,style:{marginLeft:g?-230:0},theme:"light",className:ye.sider,children:t(vn,{})}),f(Ee,{className:"relative",children:[t(xn,{className:"bg-[#FBFBFB]",children:i.children}),u?t(Ni,{style:{left:0,right:0,bottom:0},toggleWindow:()=>l(!u),defaultTab:c}):t(K,{})]})]}),t(An,{className:ye.footer,children:t(ni,{version:s,env:o,errorInfo:a==null?void 0:a.errorInfo,startTime:a==null?void 0:a.startTime,engineStatus:a==null?void 0:a.engineStatus,hookStatus:a==null?void 0:a.hookStatus,toggleWindow:w=>{p(w),l(!u)}})})]});return pe().pathname.match(/^\/workbench\/modeling($|\/)/)?t(Si,{children:m}):t(ce.Provider,{value:{triggerPageEvent:w=>{var v;(v=_.current)==null||v.call(_,w)},registerPageListener:w=>{_.current=w},refreshMap:S,onRefreshMenu:$,editFlag:b,markEdit:B,navCheck:x,setFullscreen:E,isFullscreen:g},children:m})}function Ia(){const{config:i}=d.exports.useContext(kt);return i?t(Fn,{children:t(At,{})}):null}export{Ia as default};

import{r as l,a as e,F as S,j as u,b as w,a9 as _,aa as k,ax as C}from"./index.64257940.js";import{H as y}from"./Helmet.90e2ca49.js";import{i as B}from"./use-immer.module.72e4ecef.js";import{B as h}from"./button.ca276c4e.js";import{W as v}from"./workbenchContext.4d536977.js";/* empty css               */import{D as m}from"./index.a571ed2b.js";import{E as A}from"./EyeOutlined.8d71b64e.js";import{E,I as p}from"./index.93b57069.js";import{F as i}from"./index.9d56ca15.js";import"./row.04cc9265.js";import"./index.61964446.js";import{S as P}from"./index.4ef503cf.js";/* empty css               *//* empty css               */import"./index.2b25ba57.js";import"./index.d4e5ccca.js";import"./omit.173224d8.js";import"./type.4482a080.js";import"./responsiveObserve.a761adf9.js";import"./context.4fcda71f.js";import"./Portal.bf2e5144.js";import"./_baseIsEqual.ae1f3f6e.js";import"./statusUtils.e7207d24.js";import"./SearchOutlined.d2d234c2.js";import"./styleChecker.9486324a.js";l.exports.createContext([]);l.exports.createContext({});l.exports.createContext({});const D=l.exports.createContext({}),x={"save-btn":"_save-btn_dfcko_1","center-btn":"_center-btn_dfcko_19","switch-check-btn":"_switch-check-btn_dfcko_27","ssl-open-btn":"_ssl-open-btn_dfcko_34","ssl-close-btn":"_ssl-close-btn_dfcko_47","switch-set-btn":"_switch-set-btn_dfcko_64","form-contain":"_form-contain_dfcko_71","panel-style":"_panel-style_dfcko_74","form-item-icon":"_form-item-icon_dfcko_81"};function q({content:s}){const[t,a]=B(!1),r=l.exports.useMemo(()=>s==null?void 0:s.config,[s==null?void 0:s.config]);return e(S,{children:e("div",{className:"pr-110px",children:u(m,{bordered:!0,column:1,size:"small",children:[e(m.Item,{label:"\u540D\u79F0",children:s==null?void 0:s.name}),e(m.Item,{label:"\u670D\u52A1\u5730\u5740",children:r==null?void 0:r.endpoint}),u(m.Item,{label:"APP ID",children:[r==null?void 0:r.accessKeyID," "]}),e(m.Item,{label:"APP Secret",children:e("span",{children:t?u("div",{children:[r==null?void 0:r.secretAccessKey,e(A,{className:"ml-6 cursor-pointer",onClick:()=>a(!t)})]}):u("div",{children:[r==null?void 0:r.secretAccessKey.replaceAll(/./g,"*"),e(E,{className:"ml-6 cursor-pointer",onClick:()=>a(!t)})]})})}),e(m.Item,{label:"\u533A\u57DF",children:r==null?void 0:r.bucketLocation}),e(m.Item,{label:"bucketName",children:r==null?void 0:r.bucketName}),e(m.Item,{label:"\u5F00\u542FSSL",children:r!=null&&r.useSSL?e(h,{className:x["ssl-open-btn"],children:"\u5F00\u542F"}):e(h,{className:x["ssl-close-btn"],children:"\u5173\u95ED"})})]})})})}function L({content:s}){const{handleSwitch:t}=l.exports.useContext(D),a=w(),{onRefreshMenu:r}=l.exports.useContext(v),F=l.exports.useMemo(()=>s==null?void 0:s.config,[s]),[b]=i.useForm(),[n,d]=l.exports.useState(!1),g=async c=>{const o={name:c.name,config:c,useSSL:!0};let f;s?f=await _.put("/storageBucket ",{...o,id:s.id}):f=await _.post("/storageBucket ",o),a(`/workbench/storage/${f.id}`,{replace:!0}),r("storage"),t("detail",f.id)},I=c=>{k.error("\u4FDD\u5B58\u5931\u8D25\uFF01")},N=()=>{d(!0);const c=b.getFieldsValue();_.post("/s3Upload/checkConn",{config:{...c},name:c.name}).then(o=>{o!=null&&o.status?k.success("\u8FDE\u63A5\u6210\u529F"):k.error((o==null?void 0:o.msg)||"\u8FDE\u63A5\u5931\u8D25")}).finally(()=>{d(!1)})};return e("div",{className:`${x["form-contain"]}`,children:u(i,{form:b,name:"basic",labelCol:{span:4},wrapperCol:{span:11},onFinish:c=>void g(c),onFinishFailed:I,autoComplete:"off",validateTrigger:"onBlur",className:"ml-3",initialValues:{...F},children:[e(i.Item,{label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],name:"name",children:e(p,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"\u670D\u52A1\u5730\u5740",name:"endpoint",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u670D\u52A1\u5730\u5740"}],children:e(p,{addonBefore:"http(s)://",placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"App ID",rules:[{required:!0,message:"\u8BF7\u8F93\u5165 App ID"}],name:"accessKeyID",children:e(p,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"App Secret",rules:[{required:!0,message:"\u8BF7\u8F93\u5165 App Secret"}],name:"secretAccessKey",children:e(p.Password,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"\u533A\u57DF",name:"bucketLocation",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u533A\u57DF"}],children:e(p,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"bucketName",name:"bucketName",rules:[{required:!0,message:"\u8BF7\u8F93\u5165bucketName"}],children:e(p,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(i.Item,{label:"\u5F00\u542FSSL",style:{marginTop:"29px"},name:"useSSL",valuePropName:"checked",children:e(P,{className:x["switch-set-btn"],size:"small"})}),u(i.Item,{wrapperCol:{offset:4,span:16},children:[e(h,{className:"btn-cancel",onClick:()=>{if(!(s!=null&&s.id)){a(-1);return}t("detail",s==null?void 0:s.id)},children:e("span",{children:"\u53D6\u6D88"})}),e(h,{className:"btn-test ml-4",onClick:()=>N(),loading:n,children:"\u6D4B\u8BD5"}),e(h,{className:"btn-save ml-4",onClick:()=>b.submit(),children:"\u4FDD\u5B58"})]})]})})}function K({content:s,showType:t}){l.exports.useContext(v);const{handleSwitch:a}=l.exports.useContext(D);return u("div",{className:"common-form h-full flex items-stretch justify-items-stretch flex-col",children:[u("div",{className:"h-54px flex-0 bg-white flex items-center pl-11",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[e("img",{src:"/assets/ant-tree/file.png",className:"w-14px h-14px mr-1.5",alt:"\u6587\u4EF6"}),s==null?void 0:s.name,e("div",{className:"flex-1"}),t==="detail"?e(S,{children:e(h,{className:"btn-save  ml-4 mr-11",onClick:()=>a("form",s==null?void 0:s.id),children:"\u7F16\u8F91"})}):null]}),e("div",{className:"rounded-4px flex-1 min-h-0 overflow-y-auto bg-white pl-8 mx-3 mt-3 pt-8",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:t==="detail"?e(q,{content:s}):t==="form"?e(L,{content:s}):""})]})}function ce(){const{id:s}=C(),[t,a]=B("detail"),[r,F]=l.exports.useState();l.exports.useEffect(()=>{if(s==="new"){a("form"),F(void 0);return}else a("detail")},[s]),l.exports.useEffect(()=>{_.get("/storageBucket").then(n=>{var d;F((d=n==null?void 0:n.filter(g=>g.id===Number(s)))==null?void 0:d[0])})},[t]);function b(n,d){a(n)}return u(S,{children:[e(y,{children:e("title",{children:"FireBoom - \u6587\u4EF6\u5B58\u50A8"})}),e(D.Provider,{value:{handleSwitch:b},children:e(K,{showType:t,content:r})})]})}export{ce as default};

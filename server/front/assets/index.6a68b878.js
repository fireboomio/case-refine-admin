import{r as i,a as e,A as Ge,g as Te,a9 as z,j as l,F as h,aa as W,ax as Oe,b as Fe,n as De,av as He,R as We}from"./index.64257940.js";import{H as Ke}from"./Helmet.90e2ca49.js";import{u as Je,i as Xe}from"./index.esm.a8235609.js";import{i as A}from"./use-immer.module.72e4ecef.js";import{B as K}from"./button.ca276c4e.js";import{I as oe}from"./index.90bee82c.js";import{I as _}from"./index.93b57069.js";import{S as Be}from"./index.4ef503cf.js";import{W as je}from"./workbenchContext.4d536977.js";import{I as Ye,u as ea}from"./index.e073bbb6.js";import{I as H}from"./index.2b25ba57.js";import{l as Le}from"./Editor.88c5e82e.js";/* empty css               */import{F as u}from"./index.9d56ca15.js";import"./row.04cc9265.js";import"./index.61964446.js";import{M as pe}from"./index.46a9404e.js";import{R as ne}from"./Tree.0082570b.js";import"./iconUtil.71342ca5.js";import{U as Ce}from"./index.b17c0477.js";import{D as b}from"./index.a571ed2b.js";import{S as U}from"./index.21d0aee3.js";import{E as Ne}from"./50x.81c416c8.js";/* empty css               *//* empty css               */import{T as aa}from"./Table.0fc674a8.js";import{C as la}from"./index.39cec35d.js";import"./Pagination.0b310a33.js";import"./index.70ebfd77.js";import{P as sa}from"./index.396a50a9.js";import{S as ta}from"./SearchOutlined.d2d234c2.js";import{E as ua}from"./index.5c556af0.js";import{g as na}from"./parser.542c3b4e.js";import{A as Ue}from"./index.e3184aa5.js";/* empty css              */import{S as ze}from"./index.1337bcbe.js";import{T as ye}from"./index.c6a78d56.js";import{C as he}from"./Collapse.cf21e4eb.js";import{F as T}from"./FormTooltip.4fa0aed3.js";import{H as ra}from"./constant.0f5b1976.js";import{P as qe}from"./PlusOutlined.3088ee84.js";import{C as we}from"./CaretRightOutlined.3d61ece4.js";import{T as Ae}from"./index.5b2f5049.js";import{d as ia}from"./get.ab779695.js";import"./index.d4e5ccca.js";import"./omit.173224d8.js";import"./type.4482a080.js";import"./EyeOutlined.8d71b64e.js";import"./css.7dd30b7b.js";import"./Portal.bf2e5144.js";import"./DialogWrap.ed68ac9f.js";import"./pickAttrs.91b30b21.js";import"./RightOutlined.ce6e99f7.js";import"./context.4fcda71f.js";import"./_baseIsEqual.ae1f3f6e.js";import"./statusUtils.e7207d24.js";import"./path.02380b0b.js";import"./isArrayLikeObject.9676d780.js";import"./identity.af5bbf98.js";import"./stackblitz.d6583d31.js";import"./dayjs.min.9104a23a.js";import"./DoubleRightOutlined.d12d812f.js";import"./styleChecker.9486324a.js";import"./responsiveObserve.a761adf9.js";import"./isSymbol.d728fe31.js";import"./conductUtil.91a30912.js";import"./Overflow.ff04d686.js";import"./useForceUpdate.cd5983fc.js";import"./DeleteOutlined.ab1eeec0.js";import"./index.e257c064.js";import"./Dropdown.66094b27.js";import"./Sider.4bd14ece.js";import"./index.2fd29b41.js";var oa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H544v152c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V544H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h152V328c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v152h152c4.4 0 8 3.6 8 8v48z"}}]},name:"plus-circle",theme:"filled"};const ca=oa;var Me=function(p,D){return e(Ge,{...Te(Te({},p),{},{ref:D,icon:ca})})};Me.displayName="PlusCircleFilled";const da=i.exports.forwardRef(Me);i.exports.createContext([]);const Se=i.exports.createContext({});i.exports.createContext({});const ce=i.exports.createContext({});Le.config({paths:{vs:"/modules/monaco-editor/min/vs"}});function ma({content:a}){i.exports.useContext(ce),i.exports.useContext(Se);const[p,D]=A(a.name==""),[o,N]=A(""),g=a.config;return i.exports.useEffect(()=>{D(a.name=="")},[a]),i.exports.useEffect(()=>{N(g.schema)},[a.config.schema]),e(Ye,{hookPath:`customize/${a.name}`,defaultLanguage:"typescript",hideSwitch:!0})}const ha="_monaco_1n7bn_64",pa="_modal_1n7bn_72",Pe={"connect-edit-btn":"_connect-edit-btn_1n7bn_1","connect-check-btn":"_connect-check-btn_1n7bn_20","connect-check-btn-common":"_connect-check-btn-common_1n7bn_39","db-check-setting":"_db-check-setting_1n7bn_49","form-contain":"_form-contain_1n7bn_57",monaco:ha,"db-setting-table":"_db-setting-table_1n7bn_68",modal:pa},fa="_table_1srlq_1",Fa={table:fa};function ke({beforeUpload:a,setUploadPath:p,setVisible:D,basePath:o,upType:N}){const[g,k]=i.exports.useState([]),[x,P]=i.exports.useState(!1),[E,t]=i.exports.useState(""),c={name:"file",action:"/api/v1/file/uploadFile",data:{type:N},showUploadList:!1,beforeUpload:a,onChange(m){var B;m.file.status!=="uploading"&&console.log(m.file,m.fileList),m.file.status==="done"?(W.success(`${m.file.name} \u4E0A\u4F20\u6210\u529F`),P(!x)):m.file.status==="error"&&W.error(((B=m.file.response)==null?void 0:B.message)||`${m.file.name} \u4E0A\u4F20\u5931\u8D25`)}},F=(m,B)=>{B==null||B.stopPropagation(),M(m.name),P(!x)},w=m=>{m==null||m.stopPropagation()};i.exports.useEffect(()=>{let m;N===1?m=[".json",".yaml",".yml"]:N===2?m=[".db"]:N===3&&(m=[".graphql"]),z.get(`/file/${N}`,{params:{names:m}}).then(B=>{k(N===1?B.files.filter(V=>V.name.endsWith(".json")||V.name.endsWith(".yaml")):B.files)})},[x,N]);function M(m){z.delete("/file/removeFile",{data:{name:m,type:`${N}`}}).then(B=>console.log(B))}const le=[{title:"\u6587\u4EF6\u540D",dataIndex:"name",key:"name",className:"cursor-pointer"},{title:"\u5927\u5C0F",dataIndex:"size",key:"size",width:100},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"modifyTime",key:"modifyTime",width:180},{title:"\u6743\u9650",dataIndex:"permission",key:"permission",width:80},{title:"",dataIndex:"icon",key:"icon",width:80,render:(m,B)=>l("div",{className:"flex items-center justify-between",children:[e(sa,{title:"\u786E\u8BA4\u5220\u9664\uFF1F",onConfirm:V=>F(B,V),onCancel:w,okText:"\u662F",cancelText:"\u5426",children:e(H,{onClick:V=>V==null?void 0:V.stopPropagation(),type:"icon-shanchu",className:"cursor-pointer",style:{fontSize:"16px",color:"#f6595b"}})}),e("a",{href:`/api/v1/file/downloadFile?type=${N}&fileName=${B.name}`,children:e(H,{onClick:V=>V.stopPropagation(),type:"icon-xiazai",className:"cursor-pointer",style:{fontSize:"22px"}})})]})}];return l(h,{children:[l("div",{className:"flex mb-3 justify-between",children:[e(_,{style:{height:26},className:"h-26px max-w-328px",addonBefore:e(oe,{height:14,width:14,src:"/assets/folder.svg",alt:"\u76EE\u5F55",preview:!1}),defaultValue:"./"}),e(Ce,{...c,className:"cursor-pointer flex m-auto h-6 mr-3 w-12 items-center justify-center",children:e(oe,{height:16,width:16,src:"/assets/upload.svg",alt:"\u4E0A\u4F20",preview:!1})}),e(_,{value:E,onChange:m=>t(m.target.value),addonBefore:e(ta,{}),style:{width:228,height:26}})]}),e(aa,{className:Fa.table,columns:le,dataSource:g.filter(m=>m.name.includes(E)),pagination:!1,scroll:{x:738,y:455},onRow:m=>({onClick:B=>{p(`${m.name}`),D(!1)},onDoubleClick:B=>{},onContextMenu:B=>{},onMouseEnter:B=>{},onMouseLeave:B=>{}})})]})}const ga="_head_i7tcr_1",ba="_btn_i7tcr_5",ve={head:ga,btn:ba,"ant-select":"_ant-select_i7tcr_13","ant-select-selector":"_ant-select-selector_i7tcr_13"};Le.config({paths:{vs:"/modules/monaco-editor/min/vs"}});const Ea=({replaceJSON:a,initSchema:p,content:D})=>{const{id:o}=Oe(),[N,g]=A([]),[k,x]=i.exports.useState([]),[P,E]=i.exports.useState([]),[t,c]=i.exports.useState([]),[F,w]=i.exports.useState([]),[M,le]=i.exports.useState(p),[m,B]=i.exports.useState(null);i.exports.useEffect(()=>{!a||g(a.map((s,d)=>({id:d.toString(),table:s.table,field:s.field,resType:s.resType,inputType:s.inputType,isOpen:(s==null?void 0:s.isOpen)||!1})))},[a]),i.exports.useEffect(()=>{if(!!M)try{const s=na(M,{noLocation:!0}).definitions,d=s.filter(y=>y.kind==="InputObjectTypeDefinition").map(y=>({label:y.name.value,value:y.name.value}));c(d);const n=s.filter(y=>y.kind==="ObjectTypeDefinition").map(y=>({label:y.name.value,value:y.name.value}));w(n)}catch{return}},[M]),i.exports.useEffect(()=>{z.get(`/prisma/dmf/${o!=null?o:""}`,{timeout:15e3}).then(s=>{const d=(s.models||[]).map(n=>({name:n.name,fields:n.fields.map(y=>({name:y.name,title:y.title}))}));return x(d),d}).then(s=>E(s.map(d=>({label:d.name,value:d.name}))))},[o]);function V(s){var n;const d=(n=k.find(y=>y.name===s.table))==null?void 0:n.fields;return d==null?void 0:d.map(y=>({label:y.name,value:y.name}))}function Q(s,d){g(n=>{const y=n.find(q=>q.id===d.id);y.table=s})}function Z(s,d){g(n=>{const y=n.find(q=>q.id===d.id);y.field=s})}function se(s,d){g(n=>{const y=n.find(q=>q.id===d.id);y.inputType=s})}function ee(s,d){g(n=>{const y=n.find(q=>q.id===d.id);y.resType=s})}function te(s,d){g(n=>{const y=n.find(q=>q.id===d.id);y.isOpen=s})}function ae(){g(s=>s.concat({id:Date.now().toString(),table:"",field:"",resType:"",inputType:"",isOpen:!0}))}function X(){const s={...D,config:{...D.config,replaceJSONTypeFieldConfiguration:N,schemaExtension:M}};z.put("/dataSource",s)}function re(s){g(d=>d.filter(n=>n.id!==s.id))}return l("div",{className:"flex gap-6 h-[calc(100vh_-_190px)]",children:[l("div",{className:"w-2/5",children:[e("div",{className:`${ve.head}`,children:e("span",{children:"\u81EA\u5B9A\u4E49\u7C7B\u578B"})}),e(ua,{language:"graphql",value:M,onChange:s=>le(s!=null?s:"")})]}),l("div",{className:"w-3/5",children:[l("div",{className:`${ve.head} !pr-3 flex items-center justify-between`,children:[e("span",{children:"\u5B57\u6BB5\u7C7B\u578B\u6620\u5C04"}),l(K,{size:"small",className:`${ve.btn} flex items-center justify-evenly cursor-pointer`,onClick:X,children:[e(H,{type:"icon-baocun",style:{color:"#5F6269"}}),e("span",{className:"text-sm",children:"\u4FDD\u5B58"})]})]}),l("div",{className:"relative py-3 px-3.5 bg-[#FFFFFF]",children:[e(da,{onClick:ae,className:"absolute right-2 top-1 z-2 cursor-pointer !text-[#649FFF]"}),l("table",{className:"w-full bg-[#FFFFFFFF] disable-common-select",children:[e("thead",{className:"leading-38px bg-[#5F62690D]",children:l("tr",{className:"",children:[e("th",{children:"\u8868"}),e("th",{children:"\u5B57\u6BB5"}),e("th",{children:"\u54CD\u5E94\u7C7B\u578B"}),e("th",{children:"\u8F93\u5165\u7C7B\u578B"}),e("th",{children:"\u662F\u5426\u5F00\u542F"}),e("th",{})]})}),e("tbody",{children:N.map((s,d)=>l("tr",{onMouseEnter:()=>B(d),onMouseLeave:()=>B(null),className:`${m===d?"bg-[#F8F8F9FF]":""} h-45px`,children:[e("td",{children:e(U,{className:"disable-common-select",defaultValue:s.table,style:{width:120},bordered:!1,options:P,value:s.table,onChange:n=>Q(n,s)})}),e("td",{children:e(U,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:V(s),value:s.field,onChange:n=>Z(n,s)})}),e("td",{children:e(U,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:F,value:s.resType,onChange:n=>ee(n,s)})}),e("td",{children:e(U,{className:"disable-common-select",defaultValue:"",style:{width:120},bordered:!1,options:t,value:s.inputType,onChange:n=>se(n,s)})}),e("td",{children:e(Be,{className:"w-8 h-2",checked:s.isOpen,onChange:n=>te(n,s)})}),e("td",{children:e(H,{className:`cursor-pointer ${m===d?"visible":"invisible"}`,style:{color:"#F21212FF"},type:"icon-shanchu",onClick:()=>re(s)})})]},d))})]})]})]})]})},ya=Ea,{Option:Re}=U,Ba=/^(([0-9]|[1-9]\d{1,3}|[1-5]\d{4}|6[0-5]{2}[0-3][0-5]))$/,Ca=/^[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?$/,va=/^((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)(\.((25[0-5])|(2[0-4]\d)|(1\d\d)|([1-9]\d)|\d)){3}$/,wa="/static/upload/sqlite";function Aa({content:a,type:p}){var R,I,Y,O,ue;const D=Fe(),{handleToggleDesigner:o,handleSave:N}=i.exports.useContext(ce),[g,k]=A(!1),[x,P]=A(!1),[E]=u.useForm(),t=a.config;A({});const[c,F]=A(!0),[w,M]=A([]),[le,m]=A(""),[B,V]=A(!1),Q=t.dbType,Z=v=>{E.setFieldValue(["databaseUrl","val"],v),E.setFieldValue(["databaseUrl","kind"],"0")},se=v=>{var C,j;switch(v){case"0":F(!0),E.setFieldValue(["databaseUrl","val"],""),E.validateFields();return;case"1":F(!1),m((j=(C=w.at(0))==null?void 0:C.label)!=null?j:""),E.setFieldValue(["databaseUrl","val"],""),E.validateFields();return;default:F(!1);return}},ee=v=>{m(v)};i.exports.useEffect(()=>{De("/env").then(v=>v.filter(C=>C.isDel===0).map(C=>({label:C.key,value:C.key}))).then(v=>M(v))},[]),console.log(a);const te={mysql:{pattern:/^mysql:\/\/.{1,120}$/g,message:"\u4EE5 mysql:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D",required:!0},postgresql:{pattern:/^postgresql:\/\/.{1,115}$/g,message:"\u4EE5 postgresql:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D",required:!0},mongodb:{pattern:/^mongodb:\/\/.{1,118}$/g,message:"\u4EE5 mongodb:// \u5F00\u5934\uFF0C\u4E0D\u8D85\u8FC7128\u4F4D",required:!0}}[String(a==null?void 0:a.config.dbType).toLowerCase()],ae=Q==="SQLite"?e(u.Item,{rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20\u6587\u4EF6"}],label:e(h,{children:e("span",{children:"\u8DEF\u5F84"})}),colon:!1,name:["databaseUrl","val"],style:{marginBottom:"20px"},children:e(_,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>V(!0),suffix:e("a",{onClick:()=>V(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}):e(u.Item,{label:"\u8FDE\u63A5URL",children:l(_.Group,{compact:!0,children:[e(u.Item,{name:["databaseUrl","kind"],noStyle:!0,children:l(U,{className:"w-1/5",onChange:se,children:[e(Re,{value:"0",children:"\u503C"}),e(Re,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),c?e(u.Item,{name:["databaseUrl","val"],noStyle:!0,rules:te?[te]:[],children:e(_,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"})},1):e(u.Item,{name:["databaseUrl","val"],noStyle:!0,rules:[],children:e(U,{className:"w-1/5",style:{width:"80%"},options:w,value:le,onChange:ee})},2)]})}),X=l(h,{children:[e(u.Item,{label:"\u4E3B\u673A:",name:"host",rules:[{required:!0,message:"\u4E3B\u673A\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:Ca||va,message:"\u8BF7\u586B\u5199\u89C4\u8303\u57DF\u540D\u6216\u8005ip"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:"\u6570\u636E\u5E93\u540D:",name:"dbName",rules:[{required:!0,message:"\u6570\u636E\u5E93\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_-]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:"\u7AEF\u53E3:",name:"port",rules:[{required:!0,message:"\u7AEF\u53E3\u53F7\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:Ba,message:"\u7AEF\u53E3\u8303\u56F4\u4E3A0-9999"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:"\u7528\u6237:",name:"userName",rules:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:"\u5BC6\u7801:",name:"password",children:e(_.Password,{placeholder:"\u8BF7\u8F93\u5165..."})})]}),[re,s]=A(ae);if(i.exports.useEffect(()=>{p==="form"&&E.resetFields(),s(t.appendType=="1"?X:ae)},[a,p]),i.exports.useEffect(()=>{s(ae)},[c]),!a)return e(Ne,{});const d=async v=>{const C={...t,...v};C.databaseUrl===void 0?C.databaseUrl={}:C.databaseUrl.kind===void 0&&(C.databaseUrl.kind="0");let j;if(a.name==""||a.name.startsWith("example_")){const fe={...a,config:C,name:v.apiNamespace};Reflect.deleteProperty(fe,"id");const ge=await z.post("/dataSource",fe);a.id=ge,j=a}else j={...a,config:C,name:v.apiNamespace},await z.put("/dataSource",j);N(j)},n=v=>{console.log("Failed:",v)},y=v=>{const C=E.getFieldsError().some(({errors:j})=>j.length);k(C)},q=v=>{const C={...t,...E.getFieldsValue()};C.databaseUrl===void 0?C.databaseUrl={}:C.databaseUrl.kind===void 0&&(C.databaseUrl.kind="0"),z.post("/checkDBConn",{sourceType:a.sourceType,config:C}).then(j=>{j!=null&&j.status?W.success("\u8FDE\u63A5\u6210\u529F"):W.error((j==null?void 0:j.msg)||"\u8FDE\u63A5\u5931\u8D25")})},f=v=>{switch(v){case"0":s(ae);break;case"1":s(X);break;default:s("");break}};return l(h,{children:[e(pe,{className:Pe.modal,title:null,footer:null,open:B,onOk:()=>V(!1),onCancel:()=>V(!1),width:920,children:e(ke,{basePath:wa,setUploadPath:Z,setVisible:V,upType:2,beforeUpload:v=>{const C=v.name.endsWith(".db");return C||W.error("\u53EA\u5141\u8BB8\u4E0A\u4F20 db \u683C\u5F0F\u6587\u4EF6"),C||Ce.LIST_IGNORE}})}),p==="detail"?l("div",{children:[e("div",{className:"py-10px flex justify-end",children:e("div",{className:"h-22px bg-[#F9F9F9] rounded-2px text-[#E92E5E] w-21 flex items-center justify-center cursor-pointer",onClick:()=>o("setting",a.id),children:"\u66F4\u591A\u8BBE\u7F6E"})}),e("div",{children:l(b,{bordered:!0,column:1,size:"small",children:[e(b.Item,{label:"\u8FDE\u63A5\u540D",children:t.apiNamespace}),e(b.Item,{label:"\u6570\u636E\u5E93\u7C7B\u578B",children:t.dbType}),Q==="SQLite"?e(b.Item,{label:"\u8DEF\u5F84",children:(I=(R=t.databaseUrl)==null?void 0:R.val)!=null?I:""}):l(h,{children:[Q==="MongoDB"?e(h,{}):e(b.Item,{label:"\u8FDE\u63A5\u7C7B\u578B",children:t.appendType=="0"?"\u8FDE\u63A5URL":t.appendType=="1"?"\u8FDE\u63A5\u53C2\u6570":""}),t.appendType=="1"?l(h,{children:[e(b.Item,{label:"\u4E3B\u673A",children:t.host}),e(b.Item,{label:"\u7AEF\u53E3",children:t.port}),e(b.Item,{label:"\u6570\u636E\u5E93\u540D",children:t.dbName}),e(b.Item,{label:"\u7528\u6237",children:t.userName}),e(b.Item,{label:"\u5BC6\u7801",children:x?l("span",{children:[t.password,e(H,{className:"ml-2",type:"icon-xiaoyanjing-chakan",onClick:()=>P(!x)})]}):l("span",{children:["**********",e(H,{className:"ml-2",type:"icon-xiaoyanjing-yincang",onClick:()=>P(!x)})]})})]}):e(h,{children:e(b.Item,{label:"\u8FDE\u63A5URL",children:(Y=t.databaseUrl)==null?void 0:Y.val})})]})]})})]}):p==="form"?e("div",{children:e("div",{className:`${Pe["form-contain"]} py-6 rounded-xl mb-4`,children:l(u,{form:E,style:{width:"90%"},name:"basic",labelCol:{span:4},wrapperCol:{span:12},onFinish:v=>void d(v),onFinishFailed:n,onValuesChange:y,validateTrigger:["onBlur","onChange"],autoComplete:"new-password",labelAlign:"right",initialValues:{apiNamespace:t.apiNamespace,dbType:t.dbType,appendType:t.appendType||"0",host:t.host,dbName:t.dbName,port:t.port,userName:t.userName,password:t.password,databaseUrl:{kind:((O=t.databaseUrl)==null?void 0:O.kind)||"0",val:(ue=t.databaseUrl)==null?void 0:ue.val}},children:[e(u.Item,{label:"\u540D\u79F0:",name:"apiNamespace",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:new RegExp("^[a-zA-Z_][a-zA-Z0-9_]*$","g"),message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165...",autoComplete:"off",autoFocus:!0})}),Q==="SQLite"||Q==="MongoDB"?e(h,{}):e(u.Item,{label:"\u8FDE\u63A5\u7C7B\u578B:",name:"appendType",children:l(ne.Group,{onChange:v=>f(v.target.value),children:[e(ne,{value:"0",style:{marginRight:"50px"},children:"\u8FDE\u63A5URL"}),e(ne,{value:"1",children:" \u8FDE\u63A5\u53C2\u6570 "})]})}),re,l(u.Item,{wrapperCol:{offset:4,span:16},children:[e(K,{className:"btn-cancel",onClick:()=>{a.name&&a.name!=="example_pgsql"?o("detail",a.id,a.sourceType):D("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})}),e(K,{className:"btn-test ml-4",onClick:()=>q(),children:"\u6D4B\u8BD5"}),e(K,{className:"btn-save ml-4",onClick:()=>{E.submit()},children:"\u4FDD\u5B58"})]})]})})}):e(ya,{content:a,initSchema:t.schemaExtension,replaceJSON:t.replaceJSONTypeFieldConfiguration})]})}const Da="/assets/ali.c0340600.svg",Na="/assets/CockroachDB.2c178614.svg",Sa="/assets/Faas.ad3d2bf0.svg",ka="/assets/GraphalAPI.7740e296.svg",_a="/assets/MariaDB.6fe1963e.svg",xa="/assets/MongoDB.491466e8.svg",Ia="/assets/MySQL.1461110d.svg",Ta="/assets/node.js.9103b122.svg",Pa="/assets/Planetscale.7a27b09b.svg",Ra="/assets/PostgreSQL.2a7e38b3.svg",$a="/assets/RabbitMQ.2a742049.svg",Va="/assets/RESTAPI.7b64fc68.svg",Oa="/assets/RocketMQ.58d7dabc.svg",ja="/assets/SQLite.48a4dbe0.svg",La="/assets/SQLServer.bda97784.svg",Ua="_title_85zzx_1",za="_coming_85zzx_9",$e={title:Ua,coming:za},Qe=[{name:"API",items:[{name:"REST API",icon:Va,sourceType:2},{name:"GraphQL API",icon:ka,sourceType:3}]},{name:"\u6570\u636E\u5E93",items:[{name:"PostgreSQL",icon:Ra,sourceType:1,dbType:"PostgreSQL"},{name:"MySQL",icon:Ia,sourceType:1,dbType:"MySQL"},{name:"MongoDB",icon:xa,sourceType:1,dbType:"MongoDB"},{name:"Sqlite",icon:ja,sourceType:1,dbType:"SQLite"},{name:"CockroachDB",icon:Na,sourceType:1,dbType:"CockroachDB",coming:!0},{name:"SQL Server",icon:La,sourceType:1,dbType:"SQL Server",coming:!0},{name:"Plantscale",icon:Pa,sourceType:1,dbType:"Plantscale",coming:!0},{name:"MariaDB",icon:_a,sourceType:1,dbType:"MariaDB",coming:!0}]},{name:"\u6D88\u606F\u961F\u5217",items:[{name:"RabbitMQ",icon:$a,coming:!0},{name:"RocketMQ",icon:Oa,coming:!0},{name:"\u963F\u91CC\u4E91\u7269\u8054\u7F51\u5E73\u53F0",icon:Da,coming:!0}]},{name:"\u81EA\u5B9A\u4E49",items:[{name:"node.js",icon:Ta,sourceType:4},{name:"Faas",icon:Sa,sourceType:4,coming:!0}]}],Ze={};Qe.forEach(({items:a})=>{a.forEach(({sourceType:p,dbType:D,icon:o})=>{Ze[`${p}_${D!=null?D:""}`.toLowerCase()]=o})});function qa(){i.exports.useContext(Se);const{handleToggleDesigner:a,handleCreate:p,handleSave:D}=i.exports.useContext(ce),[o,N]=i.exports.useState(Qe),[g,k]=i.exports.useState([]),x=i.exports.useRef("");i.exports.useEffect(()=>{z.get("/dataSource/example").then(t=>(k(t.map(c=>c.config)),t)).then(t=>t.map(c=>{var F;return{name:c.config.name,icon:Ze[`${c.config.sourceType}_${(F=c.config.config.dbType)!=null?F:""}`.toLowerCase()],sourceType:c.config.sourceType,dbType:c.config.config.dbType}})).then(t=>{N(c=>c.concat({name:"\u793A\u4F8B\u6570\u636E\u6E90",items:t}))})},[]);function P(){pe.info({title:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90\u540D\u79F0",content:e(_,{autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165",onChange:t=>{x.current=t.target.value}}),okText:"\u521B\u5EFA",onOk:async()=>{if(!x.current)return;let t={name:x.current,config:{apiNamespace:x.current,serverName:x.current},sourceType:4,switch:0};const c=await z.post("/dataSource",t);t.id=c,D(t)}})}function E(t,c,F){if(t===4)return P();let w={id:Date.now(),name:"",config:{dbType:c},sourceType:t,switch:0};F.startsWith("example_")&&(w=g.find(M=>M.name===F)),w.id=Date.now(),p(w)}return e(h,{children:o.map(t=>l("div",{className:"mb-12",children:[e("div",{className:`text-lg ${$e.title}`,children:e("span",{className:"pl-2.5",children:t.name})}),e("div",{className:"flex flex-wrap my-4 gap-x-9.5 gap-y-5 items-center",children:t.items.map(c=>l("div",{className:"border rounded cursor-pointer bg-[#F8F9FD] border-gray-300/20 min-w-53 py-9px pl-4 transition-shadow text-[#333333] w-53 hover:shadow-lg flex items-center relative",onClick:()=>!c.coming&&E(c.sourceType,c.dbType,c.name),children:[e("div",{className:"bg-white rounded-3xl h-7 shadow w-7 inline-flex items-center justify-center",children:c.logo?e(H,{type:c.logo,style:{fontSize:"16px"}}):e("img",{alt:"",src:c.icon})}),e("span",{className:"ml-3"+(c.coming?" text-[#787D8B]":""),children:c.name}),c.coming&&e("div",{className:$e.coming,children:"\u5373\u5C06"})]},c.name))})]},t.name))})}const Ma="_modal_1y1rp_56",L={"edit-btn":"_edit-btn_1y1rp_1","switch-check-btn":"_switch-check-btn_1y1rp_20","descriptions-box":"_descriptions-box_1y1rp_26","collapse-box":"_collapse-box_1y1rp_29","form-icon":"_form-icon_1y1rp_35","label-style":"_label-style_1y1rp_39","connect-check-btn-common":"_connect-check-btn-common_1y1rp_43","table-contain":"_table-contain_1y1rp_53",modal:Ma},be=a=>e(oe,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[a]}),Qa="/static/upload/oas",Za=ra.map(a=>({label:a,value:a}));function Ga({content:a,type:p}){var q;const D=Fe(),o=a.config,{handleSave:N,handleToggleDesigner:g}=i.exports.useContext(ce);A({});const[k,x]=A({});A(!1);const[P,E]=A(o.loadSchemaFromString!==void 0),[t,c]=A(!1),[F,w]=A(!0),[M,le]=A([]),[m,B]=A(""),[V,Q]=A(!1),[Z]=u.useForm(),{Option:se}=U,{Panel:ee}=he,te=/^https?:\/\/[-.\w\d:/]+$/i;i.exports.useEffect(()=>{E(!!o.loadSchemaFromString)},[p]),i.exports.useEffect(()=>{Z.resetFields()},[a,p]),i.exports.useEffect(()=>{De("/env").then(f=>f.filter(R=>R.isDel===0).map(R=>({label:R.key,value:R.key}))).then(f=>le(f))},[]);const ae=async f=>{var Y;f.headers=(Y=f.headers)==null?void 0:Y.filter(O=>O.key!=null);const R={...f};let I;if(a.name===""||a.id.toString().length>10){const O={...a,config:R,name:f.apiNameSpace};Reflect.deleteProperty(O,"id");const ue=await z.post("/dataSource",O);a.id=ue,I=a}else I={...a,config:R,name:f.apiNameSpace},await z.put("/dataSource",I);N(I)},X=f=>{console.log("Failed:",f)},re=f=>{switch(f){case"0":w(!0),x({pattern:/^.{1,2000}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E2000\u7684\u975E\u7A7A\u503C"});return;case"1":w(!1);return;case"2":w(!0),x({pattern:/^\w+$/g,message:"\u8BF7\u8F93\u5165\u975E\u7A7A\u503C"});return;default:return}},s=[],d=f=>{x({type:"array",validator(R,I){if(!!I)return I.every(Y=>Y.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/g))?Promise.resolve():Promise.reject("\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210")}})};function n(){var R;const f=Z.getFieldsValue();f.headers=(R=f.headers)==null?void 0:R.filter(I=>I.key!=null),z.post("/checkDBConn",f).then(I=>{I!=null&&I.status?W.success("\u8FDE\u63A5\u6210\u529F"):W.error((I==null?void 0:I.msg)||"\u8FDE\u63A5\u5931\u8D25")})}const y=f=>{Z.setFieldValue("loadSchemaFromString",f)};return a?l(h,{children:[p==="detail"?l(h,{children:[e("div",{className:"flex justify-center mb-8",children:l(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u540D\u79F0",e(T,{title:"\u540D\u79F0"})]})}),className:"justify-start",children:o.apiNameSpace}),e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["Graphql \u7AEF\u70B9",e(T,{title:"Graphql \u7AEF\u70B9"})]})}),className:"justify-start",children:o.url}),o!=null&&o.loadSchemaFromString?l(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u6307\u5B9ASchema",e(T,{title:"\u6307\u5B9ASchema"})]})}),className:"justify-start",children:[e(H,{type:"icon-wenjian1"})," ",o.loadSchemaFromString]}):""]})}),e("div",{className:"text-base font-medium ml-3 mb-3",children:"\u8BF7\u6C42\u5934"}),e("div",{className:`${L["table-contain"]} mb-8`,children:e(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((q=o==null?void 0:o.headers)!=null?q:[]).map(({key:f="",kind:R="",val:I=""})=>e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:[f,e(T,{title:f})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:be(R)}),e("div",{className:"flex-1 min-w-0 ml-2",children:I})]})},f))})}),e(he,{ghost:!0,bordered:!1,defaultActiveKey:["1"],expandIcon:({isActive:f})=>e(H,{type:"icon-xiala",rotate:f?0:-90}),className:`${L["collapse-box"]} site-collapse-custom-collapse bg-light-50`,children:e(ee,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:e("div",{className:"flex justify-center mb-8",children:l(b,{bordered:!0,column:1,size:"small",labelStyle:{width:190},children:[e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u662F\u5426\u5185\u90E8",e(T,{title:"\u662F\u5426\u5185\u90E8"})]})}),className:"justify-start",children:o.internal?e(ye,{color:"green",children:"\u5F00\u542F"}):e(ye,{color:"red",children:"\u5173\u95ED"})}),e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u81EA\u5B9A\u4E49Float\u6807\u91CF",e(T,{title:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"})]})}),className:"justify-start",children:o.customFloatScalars}),e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u81EA\u5B9A\u4E49INT\u6807\u91CF",e(T,{title:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"})]})}),className:"justify-start",children:o.customIntScalars}),e(b.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5",e(T,{title:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"})]})}),className:"justify-start",children:o.skipRenameRootFields})]})})},"1")})]}):e(h,{children:l("div",{className:"py-6 rounded-xl mb-4",children:[l(u,{form:Z,name:"basic",labelCol:{span:4},wrapperCol:{span:10},onFinish:f=>void ae(f),onFinishFailed:X,autoComplete:"off",validateTrigger:["onBlur","onChange"],className:"ml-3",labelAlign:"right",initialValues:{apiNameSpace:o.apiNameSpace,url:o.url,loadSchemaFromString:o.loadSchemaFromString,internal:o.internal,customFloatScalars:o.customFloatScalars,customIntScalars:o.customIntScalars,skipRenameRootFields:o.skipRenameRootFields,headers:o.headers||[],agreement:a.id?!!o.loadSchemaFromString:!1},children:[e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u540D\u79F0:",e(T,{title:"\u540D\u79F0"})]})}),colon:!1,style:{marginBottom:"20px"},name:"apiNameSpace",rules:[{required:!0,message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u6570\u5B57\u3001\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u7EC4\u6210"}],children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["Graphql \u7AEF\u70B9:",e(T,{title:"Graphql \u7AEF\u70B9"})]})}),colon:!1,required:!0,rules:[{required:!0,message:"\u7AEF\u70B9\u4E0D\u80FD\u4E3A\u7A7A"},{pattern:te,message:"\u8BF7\u586B\u5199\u89C4\u8303\u57DF\u540D"}],style:{marginBottom:"20px"},name:"url",children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{name:"agreement",label:" ",valuePropName:"checked",children:e(la,{onChange:()=>{E(!P)},children:"\u901A\u8FC7\u53D1\u9001\u6307\u4EE4,\u81EA\u52A8\u5185\u7701Schema"})}),P?e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u6307\u5B9ASchema:",e(T,{title:"\u6307\u5B9ASchema"})]})}),colon:!1,name:"loadSchemaFromString",required:!0,style:{marginBottom:"48px"},children:e(_,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>Q(!0),suffix:e("a",{onClick:()=>Q(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}):"",e("div",{className:"text-lg ml-3 mb-3",children:"\u8BF7\u6C42\u5934:"}),e(u.Item,{wrapperCol:{span:24},children:e(u.List,{name:"headers",children:(f,{add:R,remove:I},{errors:Y})=>l(h,{children:[f.map((O,ue)=>l(ze,{align:"baseline",style:{display:"flex"},children:[e(u.Item,{className:"w-52.5",name:[O.name,"key"],children:e(Ue,{options:Za,filterOption:(v,C)=>{var j;return((j=C==null?void 0:C.label)!=null?j:"").includes(v)},placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{className:"w-40",name:[O.name,"kind"],children:l(U,{onChange:re,children:[l(se,{value:"0",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:be("0")}),"\u503C"]}),l(se,{value:"1",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:be("1")}),"\u73AF\u5883\u53D8\u91CF"]}),l(se,{value:"2",children:[e("span",{className:"mr-1 inline-flex align-top h-full items-center",children:be("2")}),"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"]})]})}),e(u.Item,{className:"w-135 flex-0",name:[O.name,"val"],rules:Z.getFieldValue(["headers",O.name,"kind"])==="0"?[{pattern:/^.{1,2000}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E2000\u7684\u975E\u7A7A\u503C"}]:[],children:Z.getFieldValue(["headers",O.name,"kind"])==="0"?e(_,{placeholder:"\u8BF7\u8F93\u5165"}):e(U,{className:"w-1/5",style:{width:"80%"},options:M,value:m,onChange:v=>B(v)})}),e(oe,{alt:"\u6E05\u9664",width:14,height:14,preview:!1,src:"/assets/clear.png",className:"cursor-pointer",onClick:()=>I(ue)})]},O.key)),l(u.Item,{wrapperCol:{span:16},children:[e(K,{type:"dashed",onClick:()=>{w(!0),R({kind:"0"})},icon:e(qe,{}),className:"text-gray-500/60 w-1/1",children:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}),e(u.ErrorList,{errors:Y})]})]})})}),e(he,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:f})=>e(we,{rotate:f?90:0}),className:`${L["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:l(ee,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:[e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u662F\u5426\u5185\u90E8",e(T,{title:"\u662F\u5426\u5185\u90E8"})]})}),valuePropName:"checked",name:"internal",colon:!1,style:{marginBottom:"20px"},children:e(Be,{className:L["switch-edit-btn"],size:"small"})}),e(u.Item,{label:e("div",{className:"",children:l("span",{className:L["label-style"],children:["\u81EA\u5B9A\u4E49Float\u6807\u91CF",e(T,{title:"\u81EA\u5B9A\u4E49Float\u6807\u91CF"})]})}),name:"customFloatScalars",rules:[k],colon:!1,style:{marginBottom:"20px"},children:e(U,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:d,children:s})}),e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u81EA\u5B9A\u4E49INT\u6807\u91CF",e(T,{title:"\u81EA\u5B9A\u4E49INT\u6807\u91CF"})]})}),name:"customIntScalars",rules:[k],colon:!1,style:{marginBottom:"20px"},children:e(U,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:d,children:s})}),e(u.Item,{label:e("div",{children:l("span",{className:L["label-style"],children:["\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5",e(T,{title:"\u6392\u9664\u91CD\u547D\u540D\u6839\u5B57\u6BB5"})]})}),colon:!1,style:{marginBottom:"20px"},name:"skipRenameRootFields",rules:[k],children:e(U,{mode:"tags",style:{width:"100%"},placeholder:"Tags Mode",onChange:d,children:s})})]},"1")})]}),e(u.Item,{wrapperCol:{offset:3,span:16},children:l("div",{className:"flex justify-center items-center w-40 mt-5",children:[e(K,{className:"btn-cancel ml-4",onClick:()=>{a.name&&a.name!=="example_graphqlApi"?g("detail",a.id,a.sourceType):D("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})}),e(K,{className:"btn-test ml-4",onClick:()=>{n()},children:"\u6D4B\u8BD5"}),e(K,{className:"btn-save ml-4",onClick:()=>{Z.submit()},children:a.name==""?"\u521B\u5EFA":"\u4FDD\u5B58"})]})})]})}),e(pe,{className:L.modal,title:null,footer:null,open:V,onOk:()=>Q(!1),onCancel:()=>Q(!1),width:920,children:e(ke,{basePath:Qa,setUploadPath:y,setVisible:Q,upType:3,beforeUpload:f=>{const R=f.name.endsWith(".graphql");return R||W.error("\u53EA\u5141\u8BB8\u4E0A\u4F20 graphql \u683C\u5F0F\u6587\u4EF6"),R||Ce.LIST_IGNORE}})}),e(pe,{title:"GraphiQL",open:t,onOk:()=>c(!1),onCancel:()=>c(!1),footer:null,centered:!0,bodyStyle:{height:"90vh"},width:"90vw"})]}):e(Ne,{})}const Ha="_modal_4l36t_42",G={"switch-check-btn":"_switch-check-btn_4l36t_1","switch-edit-btn":"_switch-edit-btn_4l36t_7","form-icon":"_form-icon_4l36t_13","connect-check-btn-common":"_connect-check-btn-common_4l36t_17","table-contain":"_table-contain_4l36t_27","redoc-container":"_redoc-container_4l36t_30",modal:Ha},Ee=a=>e(oe,{width:14,height:14,preview:!1,alt:"\u8BF7\u6C42\u5934\u7C7B\u578B",src:{0:"/assets/header-value.png",1:"/assets/header-env.png",2:"/assets/header-relay.png"}[a]}),Wa="/static/upload/oas",{TabPane:Ve}=Ae;function Ka({content:a,type:p}){var j,fe,ge,_e;const D=Fe(),{handleToggleDesigner:o,handleSave:N}=i.exports.useContext(ce),[g]=u.useForm(),[k,x]=A(!1),[P,E]=A(!1),[t,c]=A(1),[F,w]=A({}),[M,le]=A(!0),[m,B]=A(!0),[V,Q]=i.exports.useState([]),[Z,se]=A([]),[ee,te]=A(""),[ae,X]=A(!1),re=r=>{g.setFieldValue("filePath",r),g.validateFields(["filePath"]),s(r)},s=r=>{He.get(`/api/v1/file/downloadFile?type=${1}&fileName=${encodeURIComponent(r)}`).then(S=>{var ie,J,de;const $=(ie=ia(S,"data.servers"))!=null?ie:[];g.getFieldValue("baseURL")||g.setFieldsValue({baseURL:(de=(J=$[0])==null?void 0:J.url)!=null?de:""}),Q($.map(me=>{var xe,Ie;return{label:(xe=me==null?void 0:me.url)!=null?xe:"",value:(Ie=me==null?void 0:me.url)!=null?Ie:""}}))}).catch(S=>{console.error(S),Q([])})};i.exports.useEffect(()=>{var r,S;g.resetFields(),p==="form"&&((r=a==null?void 0:a.config)==null?void 0:r.filePath)&&s((S=a==null?void 0:a.config)==null?void 0:S.filePath)},[a,p]),i.exports.useEffect(()=>{De("/env").then(r=>r.filter(S=>S.isDel===0).map(S=>({label:S.key,value:S.key}))).then(r=>se(r))},[]);const d=r=>{te(r)};if(!a)return e(Ne,{});const n=a.config,y=()=>{x(!k)},q=r=>{var S,$;switch(r){case"0":B(!0),w({pattern:/^.{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"});return;case"1":B(!1),te(($=(S=Z.at(0))==null?void 0:S.label)!=null?$:"");return;case"2":B(!0),w({pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"});return;default:return}},f=()=>{var S;const r=g.getFieldsValue();r.headers=(S=r.headers)==null?void 0:S.filter($=>$.key!=null),z.post("/checkDBConn",r).then($=>{$!=null&&$.status?W.success("\u8FDE\u63A5\u6210\u529F"):W.error(($==null?void 0:$.msg)||"\u8FDE\u63A5\u5931\u8D25")})},R=async r=>{var ie;r.headers=(ie=r.headers)==null?void 0:ie.filter(J=>J.key!=null);const S={...r};let $;if(a.name==""||a.name.startsWith("example_")){const J={...a,config:S,name:r.apiNameSpace};Reflect.deleteProperty(J,"id");const de=await z.post("/dataSource",J);a.id=de,$=a}else $={...a,config:S,name:r.apiNameSpace},await z.put("/dataSource",$);N($)},I=r=>{throw W.error("\u63D0\u4EA4\u5931\u8D25!"),r},Y=r=>{c(r.target.value),le(!M)},{Option:O}=U,{Panel:ue}=he,v=r=>{r==="1"&&(B(!0),w({pattern:/^.{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}))},C=g.getFieldValue("jwtType");return l(h,{children:[e(pe,{className:G.modal,title:null,footer:null,open:ae,onOk:()=>X(!1),onCancel:()=>X(!1),width:920,children:e(ke,{basePath:Wa,setUploadPath:re,setVisible:X,upType:1,beforeUpload:r=>{const S=r.name.endsWith(".json")||r.name.endsWith(".yaml")||r.name.endsWith(".yml");return S||W.error("\u53EA\u5141\u8BB8\u4E0A\u4F20 json \u6216 yaml \u683C\u5F0F\u6587\u4EF6"),S||Ce.LIST_IGNORE}})}),p==="detail"?l(h,{children:[e("div",{className:"flex mb-8 justify-center",children:l(b,{bordered:!0,column:1,size:"small",className:G["descriptions-box"],children:[e(b.Item,{label:e(h,{children:l("span",{className:G["label-style"],children:["\u540D\u79F0 ",e(T,{title:"\u540D\u79F0"})]})}),className:"justify-start",children:n.apiNameSpace}),e(b.Item,{label:e(h,{children:l("span",{className:G["label-style"],children:["Rest \u7AEF\u70B9",e(T,{title:"Rest \u7AEF\u70B9"})]})}),className:"justify-start",children:n.baseURL}),e(b.Item,{label:e(h,{children:l("span",{className:G["label-style"],children:["\u6307\u5B9A OAS",e(T,{title:"\u6307\u5B9AOAS"})]})}),children:l("div",{className:"flex items-center",children:[e(oe,{src:"/assets/upload-file.png",width:14,height:14,alt:"\u6587\u4EF6",preview:!1}),e("span",{className:"ml-2 text-11px text-[#909399]",children:n.filePath})]})})]})}),e("div",{className:"tabs-form",children:e(Ae,{defaultActiveKey:"1",items:[{key:"1",label:"\u8BF7\u6C42\u5934",children:e(b,{className:"mb-8",bordered:!0,column:1,size:"small",labelStyle:{width:190},children:((j=n==null?void 0:n.headers)!=null?j:[]).map(({key:r="",kind:S="",val:$=""})=>e(b.Item,{label:e("div",{children:l("span",{className:G["label-style"],children:[r,e(T,{title:r})]})}),className:"justify-start",style:{wordBreak:"break-all"},children:l("div",{className:"flex items-center",children:[e("div",{className:"text-0px",children:Ee(S)}),e("div",{className:"flex-1 ml-2 min-w-0",children:$})]})},r))})},{key:"2",label:l("span",{className:G["label-style"],children:["\u6388\u6743",e(T,{title:"\u6388\u6743"})]}),children:e("div",{className:"flex mb-11 justify-center",children:l(b,{bordered:!0,column:1,size:"small",className:G["descriptions-box"],children:[e(b.Item,{label:"JWT\u83B7\u53D6",children:{0:"\u65E0",1:"\u9759\u6001",2:"\u52A8\u6001"}[(fe=n.jwtType)!=null?fe:0]}),e(b.Item,{label:"\u5BC6\u94A5",children:k?l(h,{children:[e("span",{className:"mr-5",children:(ge=n.secret)==null?void 0:ge.val}),e(H,{type:"icon-xiaoyanjing-chakan",onClick:y})]}):l(h,{children:[e("span",{className:"mr-5",children:"********"}),e(H,{type:"icon-xiaoyanjing-yincang",onClick:y})]})}),e(b.Item,{label:"\u7B7E\u540D\u65B9\u6CD5",children:n.signingMethod}),e(b.Item,{label:"Token\u7AEF\u70B9",children:n.tokenPoint})]})})}]})}),e(he,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:r})=>e(we,{rotate:r?90:0}),className:`${G["collapse-box"]} site-collapse-custom-collapse bg-white-50`,children:e(ue,{header:"\u66F4\u591A\u8BBE\u7F6E",className:"site-collapse-custom-panel",children:e(b,{bordered:!0,column:1,size:"small",children:e(b.Item,{label:e("span",{className:G["label-style"],children:"\u662F\u5426\u72B6\u6001\u8054\u5408"}),className:"justify-start",children:n.statusCodeUnions?e(ye,{color:"green",children:"\u5F00\u542F"}):e(ye,{color:"red",children:"\u5173\u95ED"})})})},"1")}),e(pe,{centered:!0,open:P,onCancel:()=>E(!1),destroyOnClose:!0,width:"80%",bodyStyle:{height:"885px",overflow:"auto"},footer:null,children:e("div",{className:G["redoc-container"],children:P&&n.filePath&&e("iframe",{title:"rapi",src:`/#/rapi-frame?url=/upload/oas/${(_e=n.filePath)!=null?_e:""}`,width:"100%",height:"100%",className:"border-none"})})})]}):e(h,{children:e("div",{className:"rounded-xl mb-4 py-6",children:l(u,{form:g,name:"basic",labelCol:{span:3},wrapperCol:{span:11},onFinish:r=>R(r),onFinishFailed:I,autoComplete:"off",validateTrigger:["onBlur","onChange"],labelAlign:"right",className:"ml-3",initialValues:{apiNameSpace:n.apiNameSpace,baseURL:n.baseURL,headers:n.headers||[],statusCodeUnions:n.statusCodeUnions,secret:n.secret||{kind:"0"},filePath:n.filePath||"",tokenPoint:n.tokenPoint,jwtType:n.jwtType},children:[e(u.Item,{label:l(h,{children:[e("span",{children:"\u547D\u540D\u7A7A\u95F4"}),e(T,{title:"\u547D\u540D\u7A7A\u95F4"})]}),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u547D\u540D\u7A7A\u95F4"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/g,message:"\u4EE5\u5B57\u6BCD\u6216\u4E0B\u5212\u7EBF\u5F00\u5934\uFF0C\u53EA\u80FD\u7531\u5B57\u6BCD\u3001\u4E0B\u5212\u7EBF\u548C\u6570\u5B57\u7EC4\u6210"}],name:"apiNameSpace",colon:!1,style:{marginBottom:"20px"},children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{label:l(h,{children:[e("span",{children:"Rest \u7AEF\u70B9"}),e(T,{title:"Rest \u7AEF\u70B9"})]}),rules:[{required:!0,type:"url",message:"\u53EA\u5141\u8BB8\u8F93\u5165\u94FE\u63A5"}],name:"baseURL",colon:!1,style:{marginBottom:"20px"},children:e(Ue,{options:V,filterOption:(r,S)=>!0,placeholder:"\u8BF7\u8F93\u5165..."})}),e(u.Item,{rules:[{required:!0,message:"\u8BF7\u4E0A\u4F20 OAS \u6587\u4EF6"}],label:l(h,{children:[e("span",{children:"\u6307\u5B9A OAS"}),e(T,{title:"\u6307\u5B9AOAS"})]}),colon:!1,name:"filePath",style:{marginBottom:"20px"},children:e(_,{placeholder:"\u8BF7\u8F93\u5165...",onClick:()=>X(!0),suffix:e("a",{onClick:()=>X(!0),children:"\u6D4F\u89C8"}),readOnly:!0})}),e("div",{className:"tabs-form",children:l(Ae,{defaultActiveKey:"1",className:"ml-3",onChange:v,children:[e(Ve,{tab:"\u8BF7\u6C42\u5934",children:e(u.Item,{wrapperCol:{xs:{span:24},sm:{span:24}},children:e(u.List,{name:"headers",children:(r,{add:S,remove:$},{errors:ie})=>l(h,{children:[r.map((J,de)=>l(ze,{align:"baseline",children:[e(u.Item,{className:"w-52.5",wrapperCol:{span:24},name:[J.name,"key"],children:e(_,{})}),e(u.Item,{className:"w-40",wrapperCol:{span:24},name:[J.name,"kind"],children:l(U,{onChange:q,children:[l(O,{value:"0",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:Ee("0")}),"\u503C"]}),l(O,{value:"1",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:Ee("1")}),"\u73AF\u5883\u53D8\u91CF"]}),l(O,{value:"2",children:[e("span",{className:"h-full mr-1 inline-flex align-top items-center",children:Ee("2")}),"\u8F6C\u53D1\u81EA\u5BA2\u6237\u7AEF"]})]})}),e(u.Item,{className:"w-135",wrapperCol:{span:24},name:[J.name,"val"],rules:g.getFieldValue(["headers",J.name,"kind"])==="0"?[{pattern:/^.{1,128}$/g,message:"\u8BF7\u8F93\u5165\u957F\u5EA6\u4E0D\u5927\u4E8E128\u7684\u975E\u7A7A\u503C"}]:[],children:g.getFieldValue(["headers",J.name,"kind"])==="0"?e(_,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"}):e(U,{className:"w-1/5",style:{width:"80%"},options:Z,value:ee,onChange:d})}),e(H,{type:"icon-guanbi",onClick:()=>$(de)})]},J.key)),l(u.Item,{wrapperCol:{span:16},children:[e(K,{type:"dashed",onClick:()=>{B(!0),S({kind:"0"})},icon:e(qe,{}),className:"text-gray-500/60 w-1/1",children:"\u65B0\u589E\u8BF7\u6C42\u5934\u4FE1\u606F"}),e(u.ErrorList,{errors:ie})]})]})})})},"1"),l(Ve,{tab:l("div",{children:[e("span",{children:"\u6388\u6743"}),e(H,{type:"icon-wenhao",className:`${G["form-icon"]} ml-1`})]}),children:[e(u.Item,{label:"JWT\u83B7\u53D6",name:"jwtType",initialValue:"0",children:l(ne.Group,{onChange:Y,value:t,children:[e(ne,{value:"0",className:"mr-20",children:"\u65E0"}),e(ne,{value:"1",className:"mr-20",children:"\u9759\u6001"}),e(ne,{value:"2",children:"\u52A8\u6001"})]})}),C==="1"?l(h,{children:[e(u.Item,{label:"\u5BC6\u94A5",children:l(_.Group,{compact:!0,children:[e(u.Item,{name:["secret","kind"],noStyle:!0,children:l(U,{className:"w-1/5",onChange:q,children:[e(O,{value:"0",children:"\u503C"}),e(O,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),m?e(u.Item,{name:["secret","val"],noStyle:!0,rules:[F],children:e(_,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"})}):e(u.Item,{name:["secret","val"],noStyle:!0,rules:[F],children:e(U,{className:"w-1/5",style:{width:"80%"},options:Z,value:ee,onChange:d})})]})}),e(u.Item,{label:"\u7B7E\u540D\u65B9\u6CD5",name:"signingMethod",initialValue:"HS256",children:e(ne,{value:"HS256",checked:!0,children:"HS256"})})]}):null,C==="2"?l(h,{children:[e(u.Item,{label:"\u5BC6\u94A5",children:l(_.Group,{compact:!0,children:[e(u.Item,{name:["secret","kind"],noStyle:!0,children:l(U,{className:"w-1/5",onChange:q,children:[e(O,{value:"0",children:"\u503C"}),e(O,{value:"1",children:"\u73AF\u5883\u53D8\u91CF"})]})}),e(u.Item,{name:["secret","val"],noStyle:!0,rules:[F],children:m?e(_,{style:{width:"80%"},placeholder:"\u8BF7\u8F93\u5165"}):e(U,{className:"w-1/5",style:{width:"80%"},options:Z,value:ee,onChange:d})})]})}),e(u.Item,{label:l(h,{children:[e("span",{children:"Token \u7AEF\u70B9"}),e(H,{type:"icon-wenhao",className:`${G["form-icon"]} ml-1`})]}),colon:!1,required:!0,style:{marginBottom:"20px"},name:"tokenPoint",children:e(_,{placeholder:"\u8BF7\u8F93\u5165..."})})]}):null]},"2")]})}),e(he,{ghost:!0,bordered:!1,defaultActiveKey:["0"],expandIcon:({isActive:r})=>e(we,{rotate:r?90:0}),children:e(ue,{header:"\u66F4\u591A",className:"site-collapse-custom-panel",children:e(u.Item,{label:e(h,{children:l("span",{className:G["label-style"],children:["\u662F\u5426\u72B6\u6001\u8054\u5408",e(T,{title:"\u662F\u5426\u72B6\u6001\u8054\u5408"})]})}),name:"statusCodeUnions",colon:!1,style:{marginBottom:0},valuePropName:"checked",children:e(Be,{className:G["switch-edit-btn"],size:"small"})})},"1")}),e(u.Item,{wrapperCol:{offset:3,span:16},children:l("div",{className:"flex mt-10 w-160px justify-center items-center",children:[e(K,{className:"btn-cancel  ml-4",onClick:()=>{a.name&&a.name!=="example_restApi"?o("detail",a.id,a.sourceType):D("/workbench/dataSource/new")},children:e("span",{children:"\u53D6\u6D88"})}),e(K,{className:"btn-test ml-4",onClick:()=>{f()},children:"\u6D4B\u8BD5"}),e(K,{className:"btn-save ml-4",onClick:()=>g.submit(),children:a.name==""?"\u521B\u5EFA":"\u4FDD\u5B58"})]})})]})})})]})}function Ja({content:a,showType:p}){const{mutate:D}=Je(),{handleToggleDesigner:o}=i.exports.useContext(ce),{onRefreshMenu:N}=i.exports.useContext(je),[g,k]=We.useState(!1),x=Fe();if(!a)return e("div",{className:"h-full p-3 pb-0",children:e("div",{className:"bg-white h-full pt-5.5 pl-5.5 overflow-auto",children:e(qa,{})})});const P=async()=>{!a||(a.switch^=1,a&&await z.put("/dataSource",a),a.sourceType===4&&(console.log(a),ea(`customize/${a.name}`,!!a.switch)),N("dataSource"))};let E="other";switch(a==null?void 0:a.sourceType){case 1:E=String(a.config.dbType)||E;break;case 2:E="rest";break;case 3:E="graphql";break}const t=F=>{z.post("/checkDBConn",{...a}).then(w=>{w!=null&&w.status?W.success("\u8FDE\u63A5\u6210\u529F"):W.error((w==null?void 0:w.msg)||"\u8FDE\u63A5\u5931\u8D25")})},c=async F=>{if(!F.match(/^\w[a-zA-Z0-9_]*$/)){W.error("\u8BF7\u8F93\u5165\u5B57\u6BCD\u3001\u6570\u5B57\u6216\u4E0B\u5212\u7EBF");return}const w={...a,name:F};await z.put("/dataSource",w),N("dataSource"),k(!1),await D(["/dataSource",String(a.id)])};return l("div",{className:"flex flex-col h-full common-form items-stretch justify-items-stretch",children:[" ",l("div",{className:"bg-white flex flex-0 h-54px pl-11 items-center",style:{borderBottom:"1px solid rgba(95,98,105,0.1)"},children:[p==="setting"?l(h,{children:[l("div",{className:"cursor-pointer flex bg-[#F9F9F9FF] mr-6 py-0.5 px-2 items-center justify-evenly",children:[e(oe,{width:12,height:7,src:"/assets/back.svg",alt:"\u8FD4\u56DE",preview:!1}),e("span",{className:"ml-1",onClick:()=>o("detail"),children:"\u8FD4\u56DE"})]}),e("div",{className:"font-medium",children:"\u9AD8\u7EA7\u8BBE\u7F6E"})]}):l(h,{children:[e("img",{className:"h-14px mr-1.5 w-14px",src:`/assets/workbench/panel-item-${E.toLowerCase()}.png`,alt:"\u6570\u636E\u6E90"}),g?e(_,{onBlur:F=>c(F.target.value),onPressEnter:F=>c(F.target.value),style:{width:"200px"},defaultValue:a==null?void 0:a.name,autoFocus:!0,placeholder:"\u8BF7\u8F93\u5165\u6570\u636E\u6E90\u540D"}):l(h,{children:[a==null?void 0:a.name,e("span",{onClick:()=>k(!0),className:"ml-3 cursor-pointer",children:e(H,{type:"icon-bianji"})})]})]}),e("div",{className:"flex-1"}),p==="detail"?l(h,{children:[e(Be,{checked:(a==null?void 0:a.switch)===1,checkedChildren:"\u5F00\u542F",unCheckedChildren:"\u5173\u95ED",onChange:P,className:"mr-4"}),a.sourceType===1?e(K,{className:"btn-test ml-4 ",onClick:()=>x(`/workbench/modeling/${a==null?void 0:a.id}`),children:"\u8BBE\u8BA1"}):e(h,{}),a.sourceType!==4?l(h,{children:[e(K,{className:"btn-test ml-4 mr-4",onClick:()=>t(),children:"\u6D4B\u8BD5"}),e(K,{className:"btn-save mr-11",onClick:()=>o("form"),children:"\u7F16\u8F91"})]}):e(h,{})]}):null]}),e("div",{className:"bg-white  flex-1 mx-3 mt-3 min-h-0 px-8 pt-5 overflow-y-auto",style:{border:"1px solid rgba(95,98,105,0.1)",borderBottom:"none",borderRadius:"4px 4px 0 0"},children:a.sourceType===1?e(Aa,{content:a,type:p}):a.sourceType===2?e(Ka,{content:a,type:p}):a.sourceType===3?e(Ga,{content:a,type:p}):a.sourceType===4?e(ma,{content:a}):e(h,{})})]})}function Xa(a,p){switch(p.type){case"fetched":return p.data;case"selected":return a;case"added":return[...a,p.data];case"changed":return a.map(D=>D.id===p.data.id?p.data:D);case"deleted":return a.filter(D=>D.id!==p.data.id);default:return a}}function bs(){const a=Fe(),{onRefreshMenu:p}=i.exports.useContext(je),[D,o]=i.exports.useReducer(Xa,[]),[N,g]=i.exports.useState(),{id:k}=Oe(),[x,P]=A("detail"),{data:E,mutate:t}=Xe(["/dataSource",k],function(F,w){return z.get(F)});i.exports.useEffect(()=>{if(k==="create"){N||a("/workbench/dataSource/new",{replace:!0});return}if(k==="new"){g(void 0);return}P("detail")},[k]),i.exports.useEffect(()=>{k!=="create"&&k!=="new"&&(P("detail"),g(E==null?void 0:E.find(F=>F.id===Number(k))))},[E,k]);const c=(F,w,M)=>{location.pathname==="/workbench/dataSource/create"?a("/workbench/dataSource/new",{replace:!0}):P(F)};return D?l(h,{children:[e(Ke,{children:e("title",{children:"FireBoom - \u6570\u636E\u6765\u6E90"})}),e(Se.Provider,{value:o,children:e(ce.Provider,{value:{handleToggleDesigner:c,handleSave:F=>{p("dataSource"),g(F),P("detail"),a(`/workbench/dataSource/${F.id}`,{replace:!0})},handleCreate:F=>{P("form"),g(F),a("/workbench/dataSource/create",{replace:!0})}},children:e(Ja,{showType:x,content:N})})})]}):e("div",{children:"loading..."})}export{bs as default};
